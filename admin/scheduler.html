<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Affiliate Blog Scheduler Pro</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #2D5BFF;
  --primary-dark: #1E3FD9;
  --primary-light: #4A73FF;
  --success: #00D084;
  --warning: #FFB020;
  --danger: #FF4757;
  --bg-main: #F8F9FB;
  --bg-surface: #FFFFFF;
  --text-primary: #1A1D29;
  --text-secondary: #6B7280;
  --text-tertiary: #9CA3AF;
  --border: #E5E7EB;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
  --radius: 12px;
  --radius-sm: 8px;
  --font-main: 'Bricolage Grotesque', system-ui, sans-serif;
  --font-mono: 'DM Mono', 'Courier New', monospace;
  --purple: #7e0882;
  --purple-pale: rgba(126,8,130,0.07);
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: var(--font-main); background: var(--bg-main); color: var(--text-primary); line-height: 1.6; overflow-x: hidden; }

/* Header */
header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 24px 32px; box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 100; }
header h2 { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; margin: 0; }
header .subtitle { font-size: 14px; opacity: 0.9; margin-top: 4px; }

/* Nav */
nav { display: flex; background: var(--bg-surface); border-bottom: 1px solid var(--border); overflow-x: auto; position: sticky; top: 81px; z-index: 99; box-shadow: var(--shadow-sm); }
nav button { flex: 1; min-width: 110px; padding: 16px 10px; color: var(--text-secondary); background: none; border: none; cursor: pointer; font-family: var(--font-main); font-size: 14px; font-weight: 600; transition: all 0.2s; border-bottom: 3px solid transparent; }
nav button:hover { background: var(--bg-main); color: var(--text-primary); }
nav button.active { color: var(--primary); border-bottom-color: var(--primary); }

/* Container & Sections */
.container { max-width: 1400px; margin: 0 auto; padding: 32px; }
section { display: none; animation: fadeIn 0.3s ease; }
section.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

/* Panels */
.panel { background: var(--bg-surface); padding: 28px; margin-bottom: 24px; border-radius: var(--radius); box-shadow: var(--shadow-sm); border: 1px solid var(--border); transition: box-shadow 0.2s; }
.panel:hover { box-shadow: var(--shadow-md); }
.panel h3 { font-size: 20px; font-weight: 700; margin-bottom: 20px; color: var(--text-primary); display: flex; align-items: center; gap: 10px; }
.panel h3::before { content: ''; width: 4px; height: 24px; background: var(--primary); border-radius: 2px; }
.panel h4 { font-size: 13px; font-weight: 600; margin: 20px 0 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }

/* Form */
input[type="text"], input[type="datetime-local"], textarea, select { width: 100%; padding: 12px 16px; margin: 8px 0; border: 2px solid var(--border); border-radius: var(--radius-sm); font-family: var(--font-main); font-size: 15px; transition: all 0.2s; background: var(--bg-surface); color: var(--text-primary); }
input:focus, textarea:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(45,91,255,0.1); }
input::placeholder, textarea::placeholder { color: var(--text-tertiary); }
textarea { resize: vertical; min-height: 120px; font-family: var(--font-mono); font-size: 14px; line-height: 1.6; }
input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: var(--primary); }
label { display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 6px 0; transition: color 0.2s; }
label:hover { color: var(--primary); }

/* Buttons */
button { font-family: var(--font-main); }
.btn { padding: 12px 24px; border: none; border-radius: var(--radius-sm); font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; white-space: nowrap; }
.btn-primary { background: var(--primary); color: white; }
.btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); box-shadow: var(--shadow-md); }
.btn-secondary { background: var(--bg-main); color: var(--text-primary); border: 2px solid var(--border); }
.btn-secondary:hover { border-color: var(--primary); color: var(--primary); }
.btn-success { background: var(--success); color: white; }
.btn-success:hover { background: #00B872; transform: translateY(-1px); }
.btn-danger { background: var(--danger); color: white; border: none; }
.btn-danger:hover { background: #E63946; }
.btn-sm { padding: 7px 14px; font-size: 13px; }
.action-row { display: flex; gap: 12px; margin-top: 20px; flex-wrap: wrap; }

/* Editor */
.meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.editor { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 20px; }
.editor-pane { display: flex; flex-direction: column; }
.editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid var(--border); }
.editor-title { font-size: 14px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
.word-count { font-size: 13px; color: var(--text-tertiary); font-family: var(--font-mono); }
.editor textarea { height: 520px; flex: 1; }
.preview { background: var(--bg-surface); padding: 28px; height: 520px; overflow-y: auto; border: 2px solid var(--border); border-radius: var(--radius-sm); line-height: 1.8; }
.preview h1 { margin: 24px 0 16px; font-size: 32px; }
.preview h2 { margin: 20px 0 12px; font-size: 24px; }
.preview h3 { margin: 16px 0 10px; font-size: 20px; }
.preview p { margin: 12px 0; }
.preview a { color: var(--primary); }
.preview img { max-width: 100%; border-radius: var(--radius-sm); margin: 16px 0; }
.preview ul, .preview ol { margin: 12px 0; padding-left: 24px; }
.preview li { margin: 6px 0; }
.preview code { background: var(--bg-main); padding: 2px 6px; border-radius: 4px; font-family: var(--font-mono); font-size: 13px; }
.preview blockquote { border-left: 4px solid var(--primary); padding-left: 20px; margin: 16px 0; color: var(--text-secondary); font-style: italic; }

/* SEO */
.score-container { display: flex; align-items: center; gap: 24px; margin-bottom: 24px; padding: 20px; background: var(--bg-main); border-radius: var(--radius-sm); }
.score-circle { width: 100px; height: 100px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 700; background: linear-gradient(135deg, var(--primary-light), var(--primary)); color: white; box-shadow: var(--shadow-md); }
.score-circle.low { background: linear-gradient(135deg, #FF6B6B, #EE5A6F); }
.score-circle.medium { background: linear-gradient(135deg, #FFB020, #FF9500); }
.score-circle.high { background: linear-gradient(135deg, #00D084, #00B872); }
.score-label { font-size: 14px; color: var(--text-secondary); margin-bottom: 4px; }
.score-text { font-size: 18px; font-weight: 600; }
#seoList { list-style: none; padding: 0; }
#seoList li { padding: 10px 16px; margin: 6px 0; border-radius: var(--radius-sm); background: var(--bg-main); display: flex; align-items: center; gap: 10px; }
#seoList li:hover { background: var(--bg-surface); transform: translateX(4px); transition: all 0.2s; }
#seoList li.pass::before { content: 'âœ“'; color: var(--success); font-weight: bold; font-size: 18px; }
#seoList li.fail::before { content: 'âœ—'; color: var(--danger); font-weight: bold; font-size: 18px; }
.stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
.stat-card { background: var(--bg-surface); padding: 20px; border-radius: var(--radius-sm); border: 2px solid var(--border); text-align: center; transition: all 0.2s; }
.stat-card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: var(--shadow-md); }
.stat-value { font-size: 32px; font-weight: 700; color: var(--primary); margin-bottom: 4px; }
.stat-label { font-size: 13px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }

/* Categories */
.multi-select { max-height: 200px; overflow-y: auto; border: 2px solid var(--border); padding: 12px; background: var(--bg-surface); border-radius: var(--radius-sm); }
.multi-select label { display: flex; align-items: center; gap: 10px; margin: 6px 0; padding: 8px 12px; border-radius: var(--radius-sm); }
.multi-select label:hover { background: var(--bg-main); }
.multi-select label.hidden { display: none; }
.category-group { margin-bottom: 16px; }
.category-group.hidden { display: none; }
.category-group-title { font-weight: 600; padding: 8px 12px; background: var(--bg-main); border-radius: var(--radius-sm); margin-bottom: 8px; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; }
.selected-categories { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; min-height: 32px; }
.selected-categories:empty::before { content: 'No categories selected'; color: var(--text-tertiary); font-size: 13px; font-style: italic; }
.category-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--primary); color: white; border-radius: 16px; font-size: 13px; font-weight: 500; animation: slideIn 0.2s ease; }
@keyframes slideIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
.category-badge button { background: none; border: none; color: white; cursor: pointer; padding: 0; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.2s; }
.category-badge button:hover { background: rgba(255,255,255,0.2); }

/* Image Upload */
.image-upload-area { padding: 16px; border: 2px dashed var(--border); border-radius: var(--radius-sm); background: var(--bg-main); transition: all 0.2s; }
.image-upload-area:hover { border-color: var(--primary); background: var(--bg-surface); }
.image-preview img { max-width: 100%; max-height: 200px; border-radius: var(--radius-sm); border: 2px solid var(--border); margin-top: 12px; }
.image-preview-actions { display: flex; gap: 8px; margin-top: 8px; }
.remove-image { background: var(--danger); color: white; border: none; padding: 6px 12px; border-radius: var(--radius-sm); cursor: pointer; font-size: 13px; font-weight: 600; }
.insert-image { background: var(--primary); color: white; border: none; padding: 6px 12px; border-radius: var(--radius-sm); cursor: pointer; font-size: 13px; font-weight: 600; }

/* Draft table */
#finalPost { background: var(--bg-main); padding: 24px; border-radius: var(--radius-sm); overflow-x: auto; font-family: var(--font-mono); font-size: 13px; line-height: 1.6; border: 2px solid var(--border); max-height: 600px; overflow-y: auto; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; background: var(--bg-surface); border-radius: var(--radius-sm); overflow: hidden; }
thead { background: var(--bg-main); }
th { padding: 14px 16px; text-align: left; font-weight: 600; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-secondary); border-bottom: 2px solid var(--border); }
td { padding: 14px 16px; border-bottom: 1px solid var(--border); }
tbody tr:hover { background: var(--bg-main); }
.status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
.status-ready { background: #D1FAE5; color: #065F46; }
.status-scheduled { background: #FEF3C7; color: #92400E; }
.status-draft { background: #E5E7EB; color: #374151; }

/* Affiliate */
.search-container { display: flex; gap: 12px; margin-bottom: 20px; }
.search-container input { flex: 1; margin: 0; }
#affiliateResults { list-style: none; padding: 0; }
#affiliateResults li { padding: 16px; margin: 8px 0; background: var(--bg-main); border-radius: var(--radius-sm); display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; }
#affiliateResults li:hover { background: var(--bg-surface); box-shadow: var(--shadow-sm); transform: translateX(4px); }
.affiliate-name { font-weight: 600; }
.affiliate-actions { display: flex; gap: 8px; }
.affiliate-link { color: var(--primary); text-decoration: none; font-weight: 600; padding: 6px 14px; border-radius: var(--radius-sm); background: rgba(45,91,255,0.1); transition: all 0.2s; font-size: 13px; cursor: pointer; border: none; font-family: var(--font-main); }
.affiliate-link:hover { background: var(--primary); color: white; }
.affiliate-link-purple { color: var(--purple); background: var(--purple-pale); }
.affiliate-link-purple:hover { background: var(--purple); color: white; }

/* Empty State */
.empty-state { text-align: center; padding: 60px 20px; color: var(--text-tertiary); }
.empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.3; }
.empty-state-text { font-size: 16px; color: var(--text-secondary); }

/* Modal */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
.modal.active { display: flex; align-items: center; justify-content: center; }
.modal-content { background: var(--bg-surface); padding: 32px; border-radius: var(--radius); max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: var(--shadow-lg); animation: slideUp 0.3s ease; }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid var(--border); }
.modal-header h3 { margin: 0; font-size: 20px; }
.modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; }
.modal-close:hover { background: var(--bg-main); }
.draft-item { padding: 16px; margin: 8px 0; background: var(--bg-main); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
.draft-item:hover { border-color: var(--primary); }
.draft-item-title { font-weight: 600; margin-bottom: 4px; }
.draft-item-meta { font-size: 13px; color: var(--text-secondary); }

/* Autosave */
.autosave-saving { color: var(--warning); }
.autosave-saved { color: var(--success); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   FEATURED PRODUCTS TAB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.product-card { background: var(--bg-main); border: 2px solid var(--border); border-radius: var(--radius-sm); padding: 20px; margin-bottom: 16px; transition: all 0.2s; }
.product-card:hover { border-color: var(--purple); box-shadow: var(--shadow-sm); }
.product-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.product-card-title { font-weight: 700; font-size: 15px; }
.product-type-toggle { display: flex; gap: 8px; }
.type-btn { padding: 5px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer; border: 2px solid var(--border); background: var(--bg-surface); color: var(--text-secondary); transition: all 0.2s; font-family: var(--font-main); }
.type-btn.active-product { border-color: var(--purple); background: var(--purple-pale); color: var(--purple); }
.type-btn.active-blog { border-color: var(--primary); background: rgba(45,91,255,0.08); color: var(--primary); }
.product-fields { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.product-fields input { margin: 0; }
.product-fields .full-width { grid-column: 1 / -1; }
.price-field { transition: all 0.3s ease; }
.price-field.hidden-field { opacity: 0; pointer-events: none; height: 0 !important; min-height: 0 !important; padding: 0 !important; border: none !important; margin: 0 !important; overflow: hidden; }

.add-product-btn { width: 100%; padding: 16px; border: 2px dashed var(--border); border-radius: var(--radius-sm); background: var(--bg-surface); color: var(--text-secondary); font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; font-family: var(--font-main); }
.add-product-btn:hover { border-color: var(--purple); color: var(--purple); background: var(--purple-pale); }

.frontmatter-output { background: #1e1e2e; color: #cdd6f4; padding: 24px; border-radius: var(--radius-sm); font-family: var(--font-mono); font-size: 13px; line-height: 1.9; max-height: 420px; overflow-y: auto; white-space: pre; border: 2px solid #313244; }
.yaml-key { color: #89b4fa; }
.yaml-string { color: #a6e3a1; }
.yaml-comment { color: #585b70; font-style: italic; }

.product-count-badge { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; background: var(--purple); color: white; border-radius: 50%; font-size: 11px; font-weight: 700; margin-left: 4px; vertical-align: middle; }

.products-preview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(175px, 1fr)); gap: 14px; margin-top: 16px; }
.product-preview-card { background: var(--bg-surface); border: 2px solid var(--border); border-radius: var(--radius-sm); padding: 14px; text-align: center; transition: all 0.2s; }
.product-preview-card:hover { border-color: var(--purple); transform: translateY(-2px); box-shadow: var(--shadow-md); }
.product-preview-name { font-weight: 700; font-size: 13px; margin-bottom: 6px; line-height: 1.3; }
.product-preview-price { font-size: 15px; font-weight: 800; color: var(--purple); margin-bottom: 6px; }
.product-preview-cta { font-size: 12px; color: var(--text-secondary); font-weight: 600; }
.product-preview-link { font-size: 11px; color: var(--primary); word-break: break-all; margin-top: 6px; display: block; opacity: 0.7; }

.copy-confirm { display: none; align-items: center; gap: 6px; padding: 8px 16px; background: #D1FAE5; color: #065F46; border-radius: var(--radius-sm); font-size: 13px; font-weight: 600; }

.products-tip { background: rgba(126,8,130,0.06); border: 1px solid rgba(126,8,130,0.2); border-radius: var(--radius-sm); padding: 14px 18px; font-size: 14px; color: var(--text-secondary); margin-bottom: 20px; line-height: 1.6; }
.products-tip strong { color: var(--purple); }
.products-tip code { background: rgba(126,8,130,0.1); padding: 2px 6px; border-radius: 4px; font-family: var(--font-mono); font-size: 12px; color: var(--purple); }

/* Responsive */
@media (max-width: 968px) {
  .editor, .meta-grid, .product-fields { grid-template-columns: 1fr; }
  nav button { min-width: 85px; font-size: 12px; padding: 12px 6px; }
  .container { padding: 16px; }
}
::-webkit-scrollbar { width: 10px; height: 10px; }
::-webkit-scrollbar-track { background: var(--bg-main); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 5px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-tertiary); }
</style>
</head>
<body>

<header>
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div>
      <h2>Affiliate Blog Scheduler Pro</h2>
      <div class="subtitle">Create, optimize, and schedule your affiliate content</div>
    </div>
    <div style="display:flex; align-items:center; gap:16px;">
      <div id="autosaveStatus" style="font-size:13px; opacity:0.8; display:flex; align-items:center; gap:8px;">
        <span id="autosaveIcon">ğŸ’¾</span>
        <span id="autosaveText">Autosave enabled</span>
      </div>
      <button onclick="loadDraft()" class="btn btn-secondary" style="padding:8px 16px; font-size:13px;">ğŸ“‚ Load Draft</button>
    </div>
  </div>
</header>

<nav>
  <button onclick="openTab('editor')" class="active" id="nav-editor">âœï¸ Editor</button>
  <button onclick="openTab('products')" id="nav-products">ğŸ›ï¸ Products <span id="productCountBadge" class="product-count-badge" style="display:none;">0</span></button>
  <button onclick="openTab('seo')" id="nav-seo">ğŸ“Š SEO</button>
  <button onclick="openTab('schedule')" id="nav-schedule">ğŸ“… Schedule</button>
  <button onclick="openTab('deploy')" id="nav-deploy">ğŸ’¾ Drafts</button>
  <button onclick="openTab('affiliate')" id="nav-affiliate">ğŸ”— Links</button>
</nav>

<div class="container">

<!-- EDITOR -->
<section id="editor" class="active">
  <div class="panel">
    <h3>Post Metadata</h3>
    <div class="meta-grid">
      <input id="title" placeholder="Post Title" type="text">
      <input id="slug" placeholder="Slug (e.g., best-accent-chairs)" type="text">
    </div>
    <textarea id="description" placeholder="Meta Description (150-160 characters recommended)" rows="3"></textarea>
    <h4>Categories</h4>
    <input type="text" id="categorySearch" placeholder="ğŸ” Search categories..." style="margin-bottom:12px;">
    <div class="selected-categories" id="selectedCategories"></div>
    <div id="categorySelect" class="multi-select"></div>
    <h4>Tags</h4>
    <input id="tags" placeholder="Comma separated tags (e.g., review, comparison, budget-friendly)" type="text">
    <h4>SEO Keywords</h4>
    <input id="seoKeywords" placeholder="Comma separated keywords" type="text">
    <h4>Featured Image</h4>
    <div class="image-upload-area">
      <input type="file" id="imageUpload" accept="image/*" style="display:none;">
      <button onclick="document.getElementById('imageUpload').click()" class="btn btn-secondary" style="width:100%;">ğŸ“¸ Upload Featured Image</button>
      <div id="imagePreviewContainer" style="margin-top:12px;"></div>
    </div>
    <label><input type="checkbox" id="disclaimer"><span>Add FTC Affiliate Disclosure</span></label>
  </div>
  <div class="panel">
    <h3>Content Editor</h3>
    <div class="editor">
      <div class="editor-pane">
        <div class="editor-header">
          <span class="editor-title">Markdown Editor</span>
          <span class="word-count" id="wordCount">0 words</span>
        </div>
        <textarea id="content" placeholder="Write or paste your Markdown content here..."></textarea>
      </div>
      <div class="editor-pane">
        <div class="editor-header"><span class="editor-title">Live Preview</span></div>
        <div class="preview" id="preview">
          <div class="empty-state"><div class="empty-state-icon">ğŸ“</div><div class="empty-state-text">Start typing to see your preview</div></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• FEATURED PRODUCTS â•â•â• -->
<section id="products">
  <div class="panel">
    <h3>Featured Products for Sidebar</h3>
    <div class="products-tip">
      Add up to <strong>5 products or blog post links</strong>. These populate the <code>featured_products:</code> block in your post's frontmatter â€” copy it straight into your <code>.md</code> file. No need to edit the file manually.<br><br>
      ğŸ›ï¸ <strong>Product</strong> â†’ generates "Shop Now â†’" with price &nbsp;|&nbsp; ğŸ“ <strong>Blog Post</strong> â†’ generates "Read More â†’" with no price
    </div>
    <div id="productsList"></div>
    <button class="add-product-btn" onclick="addProductCard()" id="addProductBtn">
      â• Add Product or Blog Post Link
    </button>
  </div>

  <div class="panel" id="productsOutputPanel" style="display:none;">
    <h3>Generated Frontmatter â€” Copy & Paste into your .md file</h3>
    <div id="frontmatterOutput" class="frontmatter-output"></div>
    <div class="action-row">
      <button onclick="copyFrontmatter()" class="btn btn-primary">ğŸ“‹ Copy to Clipboard</button>
      <button onclick="generateFrontmatter()" class="btn btn-secondary">ğŸ”„ Refresh</button>
      <span id="copyConfirm" class="copy-confirm">âœ… Copied!</span>
    </div>
    <h4 style="margin-top:28px;">Visual Preview</h4>
    <div id="productsPreviewGrid" class="products-preview-grid"></div>
  </div>
</section>

<!-- SEO -->
<section id="seo">
  <div class="panel">
    <h3>SEO Analysis</h3>
    <div class="score-container">
      <div class="score-circle" id="scoreCircle">0%</div>
      <div class="score-details">
        <div class="score-label">Overall SEO Score</div>
        <div class="score-text" id="scoreText">Your content needs work</div>
      </div>
    </div>
    <h4>Detailed Checks</h4>
    <ul id="seoList"></ul>
  </div>
  <div class="panel">
    <h3>Content Statistics</h3>
    <div class="stats-row">
      <div class="stat-card"><div class="stat-value" id="statWords">0</div><div class="stat-label">Words</div></div>
      <div class="stat-card"><div class="stat-value" id="statChars">0</div><div class="stat-label">Characters</div></div>
      <div class="stat-card"><div class="stat-value" id="statHeadings">0</div><div class="stat-label">Headings</div></div>
      <div class="stat-card"><div class="stat-value" id="statLinks">0</div><div class="stat-label">Links</div></div>
    </div>
  </div>
</section>

<!-- SCHEDULE -->
<section id="schedule">
  <div class="panel">
    <h3>Schedule Publication</h3>
    <label><span style="font-weight:600;">Publication Date & Time</span></label>
    <input type="datetime-local" id="publishDate">
    <div class="action-row">
      <button onclick="preparePost()" class="btn btn-primary">ğŸš€ Prepare Post for Publishing</button>
      <button onclick="clearForm()" class="btn btn-secondary">ğŸ—‘ï¸ Clear Form</button>
    </div>
    <div id="finalPostContainer" style="display:none; margin-top:24px;">
      <h4>Generated Post (frontmatter + content)</h4>
      <pre id="finalPost"></pre>
    </div>
  </div>
</section>

<!-- DRAFTS -->
<section id="deploy">
  <div class="panel">
    <h3>Save & Export</h3>
    <p style="color:var(--text-secondary); margin-bottom:20px;">Save your prepared post as a Markdown file.</p>
    <div class="action-row">
      <button onclick="saveDraft()" class="btn btn-success">ğŸ’¾ Save Draft to File</button>
      <button onclick="exportJSON()" class="btn btn-secondary">ğŸ“„ Export as JSON</button>
      <button onclick="copyToClipboard()" class="btn btn-secondary">ğŸ“‹ Copy to Clipboard</button>
    </div>
  </div>
  <div class="panel">
    <h3>Draft History</h3>
    <table>
      <thead><tr><th>Slug</th><th>Title</th><th>Scheduled</th><th>Status</th><th>Actions</th></tr></thead>
      <tbody id="draftList"></tbody>
    </table>
    <div id="emptyDrafts" class="empty-state" style="display:none;">
      <div class="empty-state-icon">ğŸ“­</div>
      <div class="empty-state-text">No drafts saved yet</div>
    </div>
  </div>
</section>

<!-- AFFILIATE LINKS -->
<section id="affiliate">
  <div class="panel">
    <h3>Affiliate Link Manager</h3>
    <div class="search-container">
      <input type="text" id="affiliateSearch" placeholder="Search products, brands, or categories...">
      <button onclick="searchAffiliate()" class="btn btn-primary">ğŸ” Search</button>
    </div>
    <ul id="affiliateResults"></ul>
    <div id="emptyAffiliate" class="empty-state" style="display:none;">
      <div class="empty-state-icon">ğŸ”—</div>
      <div class="empty-state-text">Search for affiliate links to get started</div>
    </div>
  </div>
  <div class="panel">
    <h3>Quick Add Link</h3>
    <input type="text" id="newLinkName" placeholder="Product Name">
    <input type="text" id="newLinkUrl" placeholder="Affiliate URL">
    <button onclick="addAffiliateLink()" class="btn btn-primary" style="margin-top:8px;">â• Add to Catalog</button>
  </div>
</section>
</div>

<!-- Load Draft Modal -->
<div id="loadDraftModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Load Autosaved Draft</h3>
      <button class="modal-close" onclick="closeLoadModal()">Ã—</button>
    </div>
    <div id="autosaveDraftPreview"></div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentTab = 'editor';
let uploadedImage = null;
let productCounter = 0;
let affiliateCatalog = [
  {name:"Roomba 960 Robot Vacuum", link:"https://amzn.to/roomba960", category:"Smart Home"},
  {name:"Dyson V11 Cordless Vacuum", link:"https://amzn.to/dysonv11", category:"Appliances"},
  {name:"Ikea Kallax Shelf Unit", link:"https://ikea.com/kallax?aff=123", category:"Furniture"},
  {name:"Philips Hue Smart Lights", link:"https://amzn.to/philipshue", category:"Smart Home"},
  {name:"Instant Pot Duo 7-in-1", link:"https://amzn.to/instantpot", category:"Kitchen"},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FEATURED PRODUCTS TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addProductCard(prefill) {
  const list = document.getElementById('productsList');
  const existing = list.querySelectorAll('.product-card').length;
  if (existing >= 5) { alert('âš ï¸ Maximum 5 products per post. Remove one to add another.'); return; }

  productCounter++;
  const id = productCounter;
  const isProduct = !prefill || prefill.type !== 'blog';

  const card = document.createElement('div');
  card.className = 'product-card';
  card.dataset.id = id;
  card.dataset.type = isProduct ? 'product' : 'blog';

  card.innerHTML = `
    <div class="product-card-header">
      <span class="product-card-title">Item ${existing + 1}</span>
      <div style="display:flex; gap:8px; align-items:center;">
        <div class="product-type-toggle">
          <button class="type-btn ${isProduct ? 'active-product' : ''}" onclick="setProductType(${id},'product',this)">ğŸ›ï¸ Product</button>
          <button class="type-btn ${!isProduct ? 'active-blog' : ''}" onclick="setProductType(${id},'blog',this)">ğŸ“ Blog Post</button>
        </div>
        <button class="btn btn-danger btn-sm" onclick="removeProductCard(${id})">âœ• Remove</button>
      </div>
    </div>
    <div class="product-fields">
      <input type="text" class="full-width" data-field="name" placeholder="Name (e.g. Velvet Accent Chair)" value="${ea(prefill?.name)}">
      <input type="text" class="price-field ${!isProduct ? 'hidden-field' : ''}" data-field="price" placeholder="Price (e.g. $299.99)" value="${ea(prefill?.price)}">
      <input type="text" data-field="link" placeholder="URL (affiliate link or /posts/slug.html)" value="${ea(prefill?.link)}">
      <input type="text" class="full-width" data-field="image" placeholder="Image path (e.g. /content/images/products/chair.jpg)" value="${ea(prefill?.image)}">
    </div>`;

  card.querySelectorAll('input').forEach(inp => inp.addEventListener('input', () => { generateFrontmatter(); updateProductBadge(); }));
  list.appendChild(card);
  updateAddButton();
  updateProductBadge();
  generateFrontmatter();
}

function ea(str) { return str ? String(str).replace(/"/g, '&quot;') : ''; }

function setProductType(id, type, btn) {
  const card = document.querySelector(`.product-card[data-id="${id}"]`);
  if (!card) return;
  card.dataset.type = type;
  card.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active-product','active-blog'));
  btn.classList.add(type === 'product' ? 'active-product' : 'active-blog');
  const priceField = card.querySelector('.price-field');
  if (type === 'blog') { priceField.classList.add('hidden-field'); priceField.value = ''; }
  else { priceField.classList.remove('hidden-field'); }
  generateFrontmatter();
}

function removeProductCard(id) {
  document.querySelector(`.product-card[data-id="${id}"]`)?.remove();
  document.querySelectorAll('.product-card').forEach((c, i) => {
    c.querySelector('.product-card-title').textContent = `Item ${i + 1}`;
  });
  updateAddButton();
  updateProductBadge();
  generateFrontmatter();
}

function updateAddButton() {
  const count = document.querySelectorAll('.product-card').length;
  document.getElementById('addProductBtn').style.display = count >= 5 ? 'none' : 'flex';
}

function updateProductBadge() {
  const count = document.querySelectorAll('.product-card').length;
  const badge = document.getElementById('productCountBadge');
  badge.textContent = count;
  badge.style.display = count > 0 ? 'inline-flex' : 'none';
}

function getProductsData() {
  return Array.from(document.querySelectorAll('.product-card')).map(card => ({
    type:  card.dataset.type,
    name:  card.querySelector('[data-field="name"]').value.trim(),
    price: card.querySelector('[data-field="price"]').value.trim(),
    link:  card.querySelector('[data-field="link"]').value.trim(),
    image: card.querySelector('[data-field="image"]').value.trim(),
  })).filter(p => p.name || p.link);
}

function buildProductsYAML(indent) {
  const products = getProductsData();
  if (!products.length) return '';
  const pad = indent || '';
  let yaml = `${pad}featured_products:\n`;
  products.forEach((p, i) => {
    const isP = p.type === 'product';
    yaml += `${pad}  # ${isP ? 'Product' : 'Blog Post'} ${i + 1}\n`;
    yaml += `${pad}  - name: "${p.name}"\n`;
    if (isP && p.price) yaml += `${pad}    price: "${p.price}"\n`;
    if (p.image) yaml += `${pad}    image: "${p.image}"\n`;
    if (p.link)  yaml += `${pad}    link: "${p.link}"\n`;
    yaml += '\n';
  });
  return yaml;
}

function generateFrontmatter() {
  const products = getProductsData();
  const panel = document.getElementById('productsOutputPanel');
  if (!products.length) { panel.style.display = 'none'; return; }
  panel.style.display = 'block';

  const raw = buildProductsYAML();

  // Syntax highlight
  const highlighted = raw
    .replace(/^(  # .+)$/gm, '<span class="yaml-comment">$1</span>')
    .replace(/^(featured_products:)/gm, '<span class="yaml-key">$1</span>')
    .replace(/^(  - name:|    price:|    image:|    link:)/gm, '<span class="yaml-key">$1</span>')
    .replace(/("[^"]*")/g, '<span class="yaml-string">$1</span>');

  document.getElementById('frontmatterOutput').innerHTML = highlighted;

  // Preview cards
  document.getElementById('productsPreviewGrid').innerHTML = products.map(p => {
    const shortLink = p.link ? (p.link.length > 38 ? p.link.slice(0,38)+'â€¦' : p.link) : 'â€”';
    return `<div class="product-preview-card">
      <div class="product-preview-name">${p.name || 'â€”'}</div>
      ${p.type === 'product' && p.price ? `<div class="product-preview-price">${p.price}</div>` : ''}
      <div class="product-preview-cta">${p.type === 'product' ? 'ğŸ›ï¸ Shop Now â†’' : 'ğŸ“ Read More â†’'}</div>
      <span class="product-preview-link">${shortLink}</span>
    </div>`;
  }).join('');
}

function copyFrontmatter() {
  const raw = buildProductsYAML();
  if (!raw) return;
  navigator.clipboard.writeText(raw).then(() => {
    const el = document.getElementById('copyConfirm');
    el.style.display = 'inline-flex';
    setTimeout(() => el.style.display = 'none', 2500);
  }).catch(() => alert('âŒ Copy failed â€” select the text manually'));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMAGE UPLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('imageUpload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file || !file.type.startsWith('image/')) { if (file) alert('âš ï¸ Please upload an image file'); return; }
    const reader = new FileReader();
    reader.onload = ev => { uploadedImage = {name:file.name, size:file.size, type:file.type, data:ev.target.result}; displayImagePreview(); triggerAutosave(); };
    reader.readAsDataURL(file);
  });
});

function displayImagePreview() {
  const container = document.getElementById('imagePreviewContainer');
  if (!uploadedImage) { container.innerHTML = ''; return; }
  const sizeKB = (uploadedImage.size / 1024).toFixed(2);
  container.innerHTML = `<div class="image-preview">
    <img src="${uploadedImage.data}" alt="Preview">
    <div style="font-size:13px;color:var(--text-secondary);margin-top:6px;">${uploadedImage.name} (${sizeKB} KB)</div>
    <div class="image-preview-actions">
      <button onclick="insertImageIntoContent()" class="insert-image">ğŸ“ Insert into Content</button>
      <button onclick="removeImage()" class="remove-image">ğŸ—‘ï¸ Remove</button>
    </div></div>`;
}

function insertImageIntoContent() {
  const md = `![${uploadedImage.name}](${uploadedImage.data})`;
  const ta = document.getElementById('content');
  const s = ta.selectionStart, e = ta.selectionEnd;
  ta.value = ta.value.slice(0,s) + md + ta.value.slice(e);
  ta.selectionStart = ta.selectionEnd = s + md.length;
  ta.focus(); updatePreview(); alert('âœ… Image inserted');
}

function removeImage() {
  if (!confirm('Remove the featured image?')) return;
  uploadedImage = null; displayImagePreview();
  document.getElementById('imageUpload').value = ''; triggerAutosave();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTOSAVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startAutosave() {
  setInterval(saveToAutosave, 30000);
  ['title','slug','content','description','tags','seoKeywords'].forEach(id => {
    document.getElementById(id)?.addEventListener('input', () => {
      clearTimeout(window.autosaveTimeout);
      window.autosaveTimeout = setTimeout(triggerAutosave, 2000);
    });
  });
}

function saveToAutosave() {
  localStorage.setItem('autosave', JSON.stringify({
    title: title.value, slug: slug.value,
    description: document.getElementById('description').value,
    content: content.value,
    tags: document.getElementById('tags').value,
    keywords: document.getElementById('seoKeywords').value,
    categories: Array.from(document.querySelectorAll('#categorySelect input:checked')).map(c => c.value),
    publishDate: document.getElementById('publishDate').value,
    disclaimer: document.getElementById('disclaimer').checked,
    image: uploadedImage,
    products: getProductsData(),
    timestamp: new Date().toISOString()
  }));
  updateAutosaveStatus('saved');
}

function triggerAutosave() { updateAutosaveStatus('saving'); setTimeout(saveToAutosave, 500); }

function updateAutosaveStatus(status) {
  const icon = document.getElementById('autosaveIcon');
  const text = document.getElementById('autosaveText');
  const el = document.getElementById('autosaveStatus');
  el.className = '';
  if (status === 'saving') { icon.textContent='ğŸ’¾'; text.textContent='Saving...'; el.classList.add('autosave-saving'); }
  else { icon.textContent='âœ…'; text.textContent='Autosaved'; el.classList.add('autosave-saved');
    setTimeout(() => { icon.textContent='ğŸ’¾'; text.textContent='Autosave enabled'; el.className=''; }, 2000); }
}

function loadDraft() {
  const raw = localStorage.getItem('autosave');
  if (!raw) { alert('â„¹ï¸ No autosaved draft found'); return; }
  const data = JSON.parse(raw);
  const productCount = data.products ? data.products.length : 0;
  document.getElementById('autosaveDraftPreview').innerHTML = `
    <div class="draft-item">
      <div class="draft-item-title">${data.title || 'Untitled Post'}</div>
      <div class="draft-item-meta">
        Last saved: ${new Date(data.timestamp).toLocaleString()}<br>
        ${data.content ? data.content.split(/\s+/).length + ' words Â· ' : ''}${productCount} featured product${productCount !== 1 ? 's' : ''}
      </div>
      <div style="margin-top:12px; display:flex; gap:8px;">
        <button class="btn btn-primary" onclick="restoreAutosave()">ğŸ“‚ Restore</button>
        <button class="btn btn-secondary" onclick="clearAutosave()">ğŸ—‘ï¸ Delete</button>
      </div>
    </div>`;
  document.getElementById('loadDraftModal').classList.add('active');
}

function closeLoadModal() { document.getElementById('loadDraftModal').classList.remove('active'); }

function restoreAutosave() {
  const data = JSON.parse(localStorage.getItem('autosave') || '{}');
  title.value = data.title || '';
  slug.value = data.slug || '';
  document.getElementById('description').value = data.description || '';
  content.value = data.content || '';
  document.getElementById('tags').value = data.tags || '';
  document.getElementById('seoKeywords').value = data.keywords || '';
  document.getElementById('publishDate').value = data.publishDate || '';
  document.getElementById('disclaimer').checked = data.disclaimer || false;
  if (data.image) { uploadedImage = data.image; displayImagePreview(); }
  document.querySelectorAll('#categorySelect input[type="checkbox"]').forEach(cb => { cb.checked = data.categories?.includes(cb.value) || false; });
  updateSelectedCategories();
  // Restore products
  document.getElementById('productsList').innerHTML = '';
  productCounter = 0;
  if (data.products?.length) data.products.forEach(p => addProductCard(p));
  updatePreview(); closeLoadModal(); alert('âœ… Draft restored!');
}

function clearAutosave() {
  if (!confirm('Delete the autosaved draft?')) return;
  localStorage.removeItem('autosave'); closeLoadModal(); alert('âœ… Draft deleted');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openTab(tab) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById('nav-' + tab).classList.add('active');
  currentTab = tab;
  if (tab === 'seo') runSEO();
  if (tab === 'products') generateFrontmatter();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SLUG / PREVIEW / WORD COUNT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const title = document.getElementById('title');
const slug = document.getElementById('slug');
const content = document.getElementById('content');

function generateSlug(t) { return t.toLowerCase().trim().replace(/[^\w\s-]/g,'').replace(/\s+/g,'-').replace(/--+/g,'-').replace(/^-+|-+$/g,''); }
title.addEventListener('input', () => { if (!slug.value || slug.dataset.autoGenerated === 'true') { slug.value = generateSlug(title.value); slug.dataset.autoGenerated = 'true'; } });
slug.addEventListener('input', () => { slug.dataset.autoGenerated = 'false'; });

content.addEventListener('input', updatePreview);
function updatePreview() {
  const text = content.value;
  document.getElementById('preview').innerHTML = text.trim() ? marked.parse(text) : `<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><div class="empty-state-text">Start typing to see your preview</div></div>`;
  document.getElementById('wordCount').textContent = text.trim().split(/\s+/).filter(Boolean).length + ' words';
  if (currentTab === 'seo') runSEO();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function runSEO() {
  const text = content.value;
  const words = text.trim().split(/\s+/).filter(Boolean).length;
  const headings = (text.match(/^#{1,6}\s/gm)||[]).length;
  const links = (text.match(/\[.*?\]\(.*?\)/g)||[]).length;
  const images = (text.match(/!\[.*?\]\(.*?\)/g)||[]).length;
  const titleLen = title.value.length;
  const descLen = document.getElementById('description').value.length;
  const kw = document.getElementById('seoKeywords').value.split(',').filter(k=>k.trim()).length;
  const cats = document.querySelectorAll('#categorySelect input:checked').length;
  const prods = document.querySelectorAll('.product-card').length;

  let score = 0, checks = [];
  const add = (pass, text) => { if (pass) score += (checks.push({pass:true,text}) && 0) || 0; checks.push({pass,text}); };

  if (words >= 800) { score+=15; checks.push({pass:true, text:`Great content length (${words} words)`}); }
  else checks.push({pass:false, text:`Content too short (${words} words, aim for 800+)`});

  if (headings >= 3) { score+=15; checks.push({pass:true, text:`Good use of headings (${headings} found)`}); }
  else checks.push({pass:false, text:`Add more headings (${headings} found, aim for 3+)`});

  if (links >= 3) { score+=15; checks.push({pass:true, text:`Good linking (${links} links)`}); }
  else checks.push({pass:false, text:`Add more links (${links} found, aim for 3+)`});

  if (images >= 2) { score+=15; checks.push({pass:true, text:`Images included (${images} found)`}); }
  else checks.push({pass:false, text:`Add images (${images} found, aim for 2+)`});

  if (titleLen >= 30 && titleLen <= 60) { score+=10; checks.push({pass:true, text:`Title length optimal (${titleLen} chars)`}); }
  else checks.push({pass:false, text:titleLen > 0 ? `Title should be 30-60 chars (currently ${titleLen})` : 'Add a title'});

  if (descLen >= 120 && descLen <= 160) { score+=10; checks.push({pass:true, text:`Meta description perfect (${descLen} chars)`}); }
  else checks.push({pass:false, text:descLen > 0 ? `Meta description should be 120-160 chars (currently ${descLen})` : 'Add a meta description'});

  if (kw >= 3) { score+=10; checks.push({pass:true, text:`Keywords defined (${kw})`}); }
  else checks.push({pass:false, text:`Add SEO keywords (${kw} found, aim for 3-5)`});

  if (cats >= 1) { score+=10; checks.push({pass:true, text:`Categories selected (${cats})`}); }
  else checks.push({pass:false, text:'Select at least one category'});

  if (prods > 0) checks.push({pass:true, text:`âœ¨ Featured products added (${prods}) â€” great for conversions!`});

  const circle = document.getElementById('scoreCircle');
  circle.textContent = score + '%';
  circle.className = 'score-circle ' + (score < 50 ? 'low' : score < 80 ? 'medium' : 'high');
  document.getElementById('scoreText').textContent = score < 50 ? 'Needs significant improvement' : score < 80 ? 'Good, but could be better' : 'Excellent SEO optimization!';

  const list = document.getElementById('seoList');
  list.innerHTML = checks.map(c => `<li class="${c.pass?'pass':'fail'}">${c.text}</li>`).join('');
  document.getElementById('statWords').textContent = words;
  document.getElementById('statChars').textContent = text.length;
  document.getElementById('statHeadings').textContent = headings;
  document.getElementById('statLinks').textContent = links;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PREPARE POST â€” products injected into frontmatter
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function preparePost() {
  if (!title.value) { alert('âš ï¸ Please add a post title'); return; }
  if (!slug.value) { alert('âš ï¸ Please add a slug'); return; }
  const scheduled = document.getElementById('publishDate').value;
  if (!scheduled) { alert('âš ï¸ Please set a publication date'); return; }

  const selectedCats = Array.from(document.querySelectorAll('#categorySelect input:checked')).map(c => c.value);
  const tags = document.getElementById('tags').value.split(',').map(t=>t.trim()).filter(Boolean);
  const keys = document.getElementById('seoKeywords').value.split(',').map(k=>k.trim()).filter(Boolean);
  const productsYAML = buildProductsYAML();

  const fm = `---
title: "${title.value}"
description: "${document.getElementById('description').value}"
slug: "${slug.value}"
scheduled_date: ${new Date(scheduled).toISOString()}
categories:
${selectedCats.map(c=>'  - '+c).join('\n')}
tags:
${tags.map(t=>'  - '+t).join('\n')}
keywords:
${keys.map(k=>'  - '+k).join('\n')}
${uploadedImage ? `featured_image: "${uploadedImage.name}"\n` : ''}${productsYAML}published: false
---

`;

  const disclosure = document.getElementById('disclaimer').checked
    ? `> âš ï¸ **FTC Disclosure**: This post contains affiliate links. We may earn a commission if you make a purchase through these links at no additional cost to you.\n\n`
    : '';

  document.getElementById('finalPost').textContent = fm + disclosure + content.value;
  document.getElementById('finalPostContainer').style.display = 'block';
  saveToDraftHistory();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE / EXPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveDraft() {
  const fp = document.getElementById('finalPost');
  if (!fp.textContent) { alert('âš ï¸ Please prepare the post first in the Schedule tab'); return; }
  if (!slug.value) { alert('âš ï¸ Slug is required to save'); return; }
  const a = Object.assign(document.createElement('a'), {href: URL.createObjectURL(new Blob([fp.textContent], {type:'text/markdown'})), download:`${slug.value}.md`});
  a.click(); alert('âœ… Draft saved!');
}

function exportJSON() {
  const data = {
    title: title.value, slug: slug.value,
    description: document.getElementById('description').value,
    content: content.value,
    tags: document.getElementById('tags').value.split(',').map(t=>t.trim()).filter(Boolean),
    keywords: document.getElementById('seoKeywords').value.split(',').map(k=>k.trim()).filter(Boolean),
    categories: Array.from(document.querySelectorAll('#categorySelect input:checked')).map(c=>c.value),
    scheduledDate: document.getElementById('publishDate').value,
    disclaimer: document.getElementById('disclaimer').checked,
    featuredImage: uploadedImage,
    featured_products: getProductsData()
  };
  const a = Object.assign(document.createElement('a'), {href:URL.createObjectURL(new Blob([JSON.stringify(data,null,2)],{type:'application/json'})), download:`${slug.value||'post'}.json`});
  a.click(); alert('âœ… Exported as JSON!');
}

function copyToClipboard() {
  const fp = document.getElementById('finalPost');
  if (!fp.textContent) { alert('âš ï¸ Please prepare the post first'); return; }
  navigator.clipboard.writeText(fp.textContent).then(() => alert('âœ… Copied!')).catch(() => alert('âŒ Copy failed'));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAFT HISTORY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveToDraftHistory() {
  let drafts = JSON.parse(localStorage.getItem('drafts')||'[]');
  drafts = [{slug:slug.value, title:title.value, scheduled:document.getElementById('publishDate').value, savedAt:new Date().toISOString()},
    ...drafts.filter(d=>d.slug!==slug.value)].slice(0,20);
  localStorage.setItem('drafts', JSON.stringify(drafts));
  updateDraftTable();
}

function updateDraftTable() {
  const drafts = JSON.parse(localStorage.getItem('drafts')||'[]');
  const body = document.getElementById('draftList');
  document.getElementById('emptyDrafts').style.display = drafts.length ? 'none' : 'block';
  body.innerHTML = drafts.map((d,i) => {
    const sc = d.scheduled ? new Date(d.scheduled) : null;
    const now = new Date();
    const [status, cls] = sc ? (sc <= now ? ['âœ… Ready','status-ready'] : ['â³ Scheduled','status-scheduled']) : ['ğŸ“ Draft','status-draft'];
    const disp = sc ? sc.toLocaleString('en-US',{month:'short',day:'numeric',year:'numeric',hour:'2-digit',minute:'2-digit'}) : 'â€”';
    return `<tr><td><code>${d.slug}</code></td><td>${d.title||'Untitled'}</td><td>${disp}</td>
      <td><span class="status-badge ${cls}">${status}</span></td>
      <td><button onclick="deleteDraft(${i})" class="btn btn-secondary" style="padding:6px 12px;font-size:13px;">ğŸ—‘ï¸</button></td></tr>`;
  }).join('');
}

function deleteDraft(i) {
  if (!confirm('Delete this draft?')) return;
  let drafts = JSON.parse(localStorage.getItem('drafts')||'[]');
  drafts.splice(i,1);
  localStorage.setItem('drafts', JSON.stringify(drafts));
  updateDraftTable();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AFFILIATE LINKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function searchAffiliate() {
  const q = document.getElementById('affiliateSearch').value.toLowerCase().trim();
  const ul = document.getElementById('affiliateResults');
  const empty = document.getElementById('emptyAffiliate');
  ul.innerHTML = '';
  if (!q) { empty.style.display='block'; return; }
  const res = affiliateCatalog.filter(a => a.name.toLowerCase().includes(q) || a.category.toLowerCase().includes(q));
  if (!res.length) { empty.style.display='block'; ul.innerHTML='<li style="text-align:center;padding:20px;color:var(--text-secondary);">No results found</li>'; return; }
  empty.style.display='none';
  ul.innerHTML = res.map(a => `
    <li>
      <div><div class="affiliate-name">${a.name}</div><div style="font-size:13px;color:var(--text-tertiary);margin-top:3px;">${a.category}</div></div>
      <div class="affiliate-actions">
        <button class="affiliate-link" onclick="insertAffiliateLink('${a.name}','${a.link}')">ğŸ“ Insert</button>
        <button class="affiliate-link affiliate-link-purple" onclick="addLinkToProducts('${a.name}','${a.link}')">ğŸ›ï¸ Add to Products</button>
      </div>
    </li>`).join('');
}

function insertAffiliateLink(name, link) {
  const ta = document.getElementById('content');
  const md = `[${name}](${link})`;
  const s = ta.selectionStart, e = ta.selectionEnd;
  ta.value = ta.value.slice(0,s) + md + ta.value.slice(e);
  ta.selectionStart = ta.selectionEnd = s + md.length;
  ta.focus(); updatePreview();
  alert(`âœ… Inserted link for "${name}"`);
}

function addLinkToProducts(name, link) {
  openTab('products');
  addProductCard({name, link, type:'product'});
  alert(`âœ… "${name}" added to Featured Products`);
}

function addAffiliateLink() {
  const name = document.getElementById('newLinkName').value.trim();
  const url  = document.getElementById('newLinkUrl').value.trim();
  if (!name || !url) { alert('âš ï¸ Please enter both product name and URL'); return; }
  affiliateCatalog.push({name, link:url, category:'Custom'});
  document.getElementById('newLinkName').value = '';
  document.getElementById('newLinkUrl').value = '';
  alert(`âœ… Added "${name}" to catalog`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CATEGORIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const categoriesList = {
  "Core Rooms":["Living Room","Bedroom","Dining Room","Home Office","Kitchen","Bathroom","Entryway & Hallway","Laundry Room","Kids Room & Nursery","Outdoor & Patio","Balcony & Small Spaces"],
  "Furniture Types":["Sofas & Seating","Beds & Bed Frames","Mattresses","Tables & Desks","Chairs & Stools","Wardrobes & Closets","TV Stands & Media Units","Shelving & Bookcases","Storage Furniture"],
  "Decor":["Wall Decor","Lighting & Lamps","Rugs & Carpets","Curtains & Window Treatments","Mirrors","Cushions & Throws","Vases & Decorative Accents","Clocks","Plants & Planters"],
  "Storage & Organization":["General Storage","Closet Organization","Shoe Storage","Kitchen Storage Solutions","Bathroom Storage Solutions","Small Space Storage"],
  "Style-Based":["Modern Style","Minimalist Style","Scandinavian Style","Luxury & Glam Decor","Boho & Rustic Decor","Traditional & Classic","Industrial Style"],
  "Buying Intent":["Budget Furniture","Luxury Furniture","Space-Saving Furniture","Multifunctional Furniture","Furniture Buying Guides","Best Of Lists","Product Reviews","Comparisons"],
  "DIY & Care":["DIY & Home Improvement","Furniture Care & Maintenance","Cleaning & Care Tips","Furniture Assembly Tips"],
  "Seasonal & Lifestyle":["Seasonal Decor","Holiday Decor","Home Makeovers","Rental-Friendly Decor"],
  "Gifts":["Home Gift Ideas","Housewarming Gifts","Luxury Home Gifts","Budget Gift Ideas"]
};

function initializeCategories() {
  const el = document.getElementById('categorySelect');
  Object.entries(categoriesList).forEach(([group, cats]) => {
    const div = document.createElement('div');
    div.className = 'category-group';
    div.dataset.group = group;
    div.innerHTML = `<div class="category-group-title">${group}</div>`;
    cats.forEach(cat => {
      const lbl = document.createElement('label');
      lbl.dataset.category = cat.toLowerCase();
      lbl.dataset.group = group.toLowerCase();
      const cb = document.createElement('input');
      cb.type = 'checkbox'; cb.value = cat; cb.id = 'cat_' + cat.replace(/\s+/g,'_');
      cb.addEventListener('change', updateSelectedCategories);
      lbl.appendChild(cb);
      lbl.appendChild(document.createTextNode(' ' + cat));
      div.appendChild(lbl);
    });
    el.appendChild(div);
  });
  document.getElementById('categorySearch').addEventListener('input', filterCategories);
}

function filterCategories() {
  const q = document.getElementById('categorySearch').value.toLowerCase().trim();
  document.querySelectorAll('.category-group').forEach(group => {
    let visible = 0;
    group.querySelectorAll('label').forEach(lbl => {
      const match = !q || lbl.dataset.category.includes(q) || lbl.dataset.group.includes(q);
      lbl.classList.toggle('hidden', !match);
      if (match) visible++;
    });
    group.classList.toggle('hidden', !visible);
  });
}

function updateSelectedCategories() {
  const container = document.getElementById('selectedCategories');
  container.innerHTML = '';
  document.querySelectorAll('#categorySelect input:checked').forEach(cb => {
    const badge = document.createElement('div');
    badge.className = 'category-badge';
    badge.innerHTML = `<span>${cb.value}</span><button title="Remove" onclick="this.closest('.category-badge').remove(); document.getElementById('${cb.id}').checked=false;">Ã—</button>`;
    container.appendChild(badge);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLEAR FORM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function clearForm() {
  if (!confirm('Clear the entire form?')) return;
  ['title','slug','description','content','tags','seoKeywords','publishDate'].forEach(id => { document.getElementById(id).value = ''; });
  document.getElementById('disclaimer').checked = false;
  uploadedImage = null; displayImagePreview();
  document.getElementById('imageUpload').value = '';
  document.querySelectorAll('#categorySelect input:checked').forEach(cb => cb.checked = false);
  updateSelectedCategories();
  document.getElementById('productsList').innerHTML = '';
  updateAddButton(); updateProductBadge();
  document.getElementById('productsOutputPanel').style.display = 'none';
  document.getElementById('finalPostContainer').style.display = 'none';
  updatePreview(); runSEO();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYBOARD SHORTCUTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('keydown', e => {
  if ((e.ctrlKey||e.metaKey) && e.key==='s') { e.preventDefault(); document.getElementById('finalPost').textContent ? saveDraft() : alert('âš ï¸ Prepare the post first'); }
  if ((e.ctrlKey||e.metaKey) && e.key==='Enter') { e.preventDefault(); preparePost(); }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', () => {
  initializeCategories();
  updateDraftTable();
  updatePreview();
  document.getElementById('emptyAffiliate').style.display = 'block';
  startAutosave();

  const saved = localStorage.getItem('autosave');
  if (saved) {
    const data = JSON.parse(saved);
    const minsAgo = Math.floor((Date.now() - new Date(data.timestamp).getTime()) / 60000);
    if (minsAgo < 1440) {
      setTimeout(() => {
        if (confirm(`Found autosaved draft from ${minsAgo < 60 ? minsAgo+' minutes' : Math.floor(minsAgo/60)+' hours'} ago. Restore it?`)) loadDraft();
      }, 800);
    }
  }
});
</script>
</body>
</html>
