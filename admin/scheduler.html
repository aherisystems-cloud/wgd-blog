<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Affiliate Blog Scheduler Pro</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #2D5BFF;
  --primary-dark: #1E3FD9;
  --primary-light: #4A73FF;
  --success: #00D084;
  --warning: #FFB020;
  --danger: #FF4757;
  --bg-main: #F8F9FB;
  --bg-surface: #FFFFFF;
  --bg-elevated: #FFFFFF;
  --text-primary: #1A1D29;
  --text-secondary: #6B7280;
  --text-tertiary: #9CA3AF;
  --border: #E5E7EB;
  --border-focus: var(--primary);
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
  --radius: 12px;
  --radius-sm: 8px;
  --font-main: 'Bricolage Grotesque', system-ui, -apple-system, sans-serif;
  --font-mono: 'DM Mono', 'Courier New', monospace;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body { 
  font-family: var(--font-main);
  background: var(--bg-main);
  color: var(--text-primary);
  line-height: 1.6;
  overflow-x: hidden;
}

/* Header */
header { 
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  padding: 24px 32px;
  box-shadow: var(--shadow-md);
  position: sticky;
  top: 0;
  z-index: 100;
  border-bottom: 3px solid rgba(255,255,255,0.1);
}

header h2 { 
  font-size: 28px;
  font-weight: 700;
  letter-spacing: -0.5px;
  margin: 0;
}

header .subtitle {
  font-size: 14px;
  opacity: 0.9;
  margin-top: 4px;
  font-weight: 400;
}

/* Navigation */
nav { 
  display: flex;
  background: var(--bg-elevated);
  border-bottom: 1px solid var(--border);
  overflow-x: auto;
  position: sticky;
  top: 81px;
  z-index: 99;
  box-shadow: var(--shadow-sm);
}

nav button { 
  flex: 1;
  min-width: 140px;
  padding: 16px 20px;
  color: var(--text-secondary);
  background: none;
  border: none;
  cursor: pointer;
  font-family: var(--font-main);
  font-size: 15px;
  font-weight: 600;
  transition: all 0.2s ease;
  border-bottom: 3px solid transparent;
  position: relative;
}

nav button:hover { 
  background: var(--bg-main);
  color: var(--text-primary);
}

nav button.active {
  color: var(--primary);
  border-bottom-color: var(--primary);
}

/* Container */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 32px;
}

/* Sections */
section { 
  display: none;
  animation: fadeIn 0.3s ease;
}

section.active { 
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Panels */
.panel { 
  background: var(--bg-surface);
  padding: 28px;
  margin-bottom: 24px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
  transition: box-shadow 0.2s ease;
}

.panel:hover {
  box-shadow: var(--shadow-md);
}

.panel h3 { 
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 20px;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 10px;
}

.panel h3::before {
  content: '';
  width: 4px;
  height: 24px;
  background: var(--primary);
  border-radius: 2px;
}

.panel h4 {
  font-size: 15px;
  font-weight: 600;
  margin: 20px 0 10px 0;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 13px;
}

/* Form Elements */
input[type="text"],
input[type="datetime-local"],
textarea,
select { 
  width: 100%;
  padding: 12px 16px;
  margin: 8px 0;
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  font-family: var(--font-main);
  font-size: 15px;
  transition: all 0.2s ease;
  background: var(--bg-surface);
  color: var(--text-primary);
}

input[type="text"]:focus,
input[type="datetime-local"]:focus,
textarea:focus,
select:focus { 
  outline: none;
  border-color: var(--border-focus);
  box-shadow: 0 0 0 3px rgba(45, 91, 255, 0.1);
}

input[type="text"]::placeholder,
textarea::placeholder {
  color: var(--text-tertiary);
}

textarea {
  resize: vertical;
  min-height: 120px;
  font-family: var(--font-mono);
  font-size: 14px;
  line-height: 1.6;
}

/* Checkboxes */
input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: var(--primary);
}

label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  padding: 6px 0;
  transition: color 0.2s ease;
}

label:hover {
  color: var(--primary);
}

/* Buttons */
button {
  font-family: var(--font-main);
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: var(--radius-sm);
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.btn-secondary {
  background: var(--bg-main);
  color: var(--text-primary);
  border: 2px solid var(--border);
}

.btn-secondary:hover {
  background: var(--bg-surface);
  border-color: var(--primary);
  color: var(--primary);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover {
  background: #00B872;
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

/* Editor Layout */
.editor { 
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-top: 20px;
}

.editor-pane {
  display: flex;
  flex-direction: column;
}

.editor-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border);
}

.editor-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.word-count {
  font-size: 13px;
  color: var(--text-tertiary);
  font-family: var(--font-mono);
}

.editor textarea { 
  height: 520px;
  flex: 1;
}

.preview { 
  background: var(--bg-surface);
  padding: 28px;
  height: 520px;
  overflow-y: auto;
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  line-height: 1.8;
}

.preview h1 { margin: 24px 0 16px; font-size: 32px; }
.preview h2 { margin: 20px 0 12px; font-size: 24px; }
.preview h3 { margin: 16px 0 10px; font-size: 20px; }
.preview p { margin: 12px 0; }
.preview a { color: var(--primary); text-decoration: none; }
.preview a:hover { text-decoration: underline; }
.preview img { max-width: 100%; height: auto; border-radius: var(--radius-sm); margin: 16px 0; }
.preview ul, .preview ol { margin: 12px 0; padding-left: 24px; }
.preview li { margin: 6px 0; }
.preview code { 
  background: var(--bg-main); 
  padding: 2px 6px; 
  border-radius: 4px;
  font-family: var(--font-mono);
  font-size: 13px;
}
.preview pre { 
  background: var(--bg-main);
  padding: 16px;
  border-radius: var(--radius-sm);
  overflow-x: auto;
  margin: 16px 0;
}
.preview blockquote {
  border-left: 4px solid var(--primary);
  padding-left: 20px;
  margin: 16px 0;
  color: var(--text-secondary);
  font-style: italic;
}

/* SEO Score */
.score-container {
  display: flex;
  align-items: center;
  gap: 24px;
  margin-bottom: 24px;
  padding: 20px;
  background: var(--bg-main);
  border-radius: var(--radius-sm);
}

.score-circle {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
  color: white;
  box-shadow: var(--shadow-md);
}

.score-circle.low { background: linear-gradient(135deg, #FF6B6B 0%, #EE5A6F 100%); }
.score-circle.medium { background: linear-gradient(135deg, #FFB020 0%, #FF9500 100%); }
.score-circle.high { background: linear-gradient(135deg, #00D084 0%, #00B872 100%); }

.score-details {
  flex: 1;
}

.score-label {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 4px;
}

.score-text {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
}

#seoList {
  list-style: none;
  padding: 0;
}

#seoList li {
  padding: 10px 16px;
  margin: 6px 0;
  border-radius: var(--radius-sm);
  background: var(--bg-main);
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.2s ease;
}

#seoList li:hover {
  background: var(--bg-surface);
  transform: translateX(4px);
}

#seoList li.pass::before {
  content: '‚úì';
  color: var(--success);
  font-weight: bold;
  font-size: 18px;
}

#seoList li.fail::before {
  content: '‚úó';
  color: var(--danger);
  font-weight: bold;
  font-size: 18px;
}

/* Multi-Select */
.multi-select { 
  max-height: 200px;
  overflow-y: auto;
  border: 2px solid var(--border);
  padding: 12px;
  background: var(--bg-surface);
  border-radius: var(--radius-sm);
}

.multi-select label { 
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 6px 0;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  transition: background 0.2s ease;
}

.multi-select label:hover {
  background: var(--bg-main);
}

.multi-select label.hidden {
  display: none;
}

.category-group {
  margin-bottom: 16px;
}

.category-group.hidden {
  display: none;
}

.category-group-title {
  font-weight: 600;
  color: var(--text-primary);
  padding: 8px 12px;
  background: var(--bg-main);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Selected Categories */
.selected-categories {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 12px;
  min-height: 32px;
}

.selected-categories:empty::before {
  content: 'No categories selected';
  color: var(--text-tertiary);
  font-size: 13px;
  font-style: italic;
}

.category-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: var(--primary);
  color: white;
  border-radius: 16px;
  font-size: 13px;
  font-weight: 500;
  animation: slideIn 0.2s ease;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.category-badge button {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  padding: 0;
  width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background 0.2s ease;
  font-size: 14px;
  line-height: 1;
}

.category-badge button:hover {
  background: rgba(255, 255, 255, 0.2);
}

.no-results {
  text-align: center;
  padding: 20px;
  color: var(--text-tertiary);
  font-style: italic;
}

/* Final Post */
#finalPost {
  background: var(--bg-main);
  padding: 24px;
  border-radius: var(--radius-sm);
  overflow-x: auto;
  font-family: var(--font-mono);
  font-size: 13px;
  line-height: 1.6;
  border: 2px solid var(--border);
  max-height: 600px;
  overflow-y: auto;
}

/* Draft Table */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: var(--bg-surface);
  border-radius: var(--radius-sm);
  overflow: hidden;
}

thead {
  background: var(--bg-main);
}

th {
  padding: 14px 16px;
  text-align: left;
  font-weight: 600;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  border-bottom: 2px solid var(--border);
}

td {
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
}

tbody tr:hover {
  background: var(--bg-main);
}

tbody tr:last-child td {
  border-bottom: none;
}

.status-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
}

.status-ready {
  background: #D1FAE5;
  color: #065F46;
}

.status-scheduled {
  background: #FEF3C7;
  color: #92400E;
}

.status-draft {
  background: #E5E7EB;
  color: #374151;
}

/* Affiliate Search */
.search-container {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
}

.search-container input {
  flex: 1;
  margin: 0;
}

#affiliateResults {
  list-style: none;
  padding: 0;
}

#affiliateResults li {
  padding: 16px;
  margin: 8px 0;
  background: var(--bg-main);
  border-radius: var(--radius-sm);
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.2s ease;
}

#affiliateResults li:hover {
  background: var(--bg-surface);
  box-shadow: var(--shadow-sm);
  transform: translateX(4px);
}

.affiliate-name {
  font-weight: 600;
  color: var(--text-primary);
}

.affiliate-link {
  color: var(--primary);
  text-decoration: none;
  font-weight: 600;
  padding: 6px 14px;
  border-radius: var(--radius-sm);
  background: rgba(45, 91, 255, 0.1);
  transition: all 0.2s ease;
}

.affiliate-link:hover {
  background: var(--primary);
  color: white;
}

/* Action Buttons Row */
.action-row {
  display: flex;
  gap: 12px;
  margin-top: 20px;
  flex-wrap: wrap;
}

/* Grid Layouts */
.meta-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

/* Stats Cards */
.stats-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--bg-surface);
  padding: 20px;
  border-radius: var(--radius-sm);
  border: 2px solid var(--border);
  text-align: center;
  transition: all 0.2s ease;
}

.stat-card:hover {
  border-color: var(--primary);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 4px;
}

.stat-label {
  font-size: 13px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-tertiary);
}

.empty-state-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.3;
}

.empty-state-text {
  font-size: 16px;
  color: var(--text-secondary);
}

/* Image Upload */
.image-upload-area {
  padding: 16px;
  border: 2px dashed var(--border);
  border-radius: var(--radius-sm);
  background: var(--bg-main);
  transition: all 0.2s ease;
}

.image-upload-area:hover {
  border-color: var(--primary);
  background: var(--bg-surface);
}

.image-preview {
  position: relative;
  display: inline-block;
  margin-top: 12px;
}

.image-preview img {
  max-width: 100%;
  max-height: 200px;
  border-radius: var(--radius-sm);
  border: 2px solid var(--border);
}

.image-preview-info {
  margin-top: 8px;
  font-size: 13px;
  color: var(--text-secondary);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.image-preview-actions {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}

.remove-image {
  background: var(--danger);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
  transition: all 0.2s ease;
}

.remove-image:hover {
  background: #E63946;
}

.insert-image {
  background: var(--primary);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
  transition: all 0.2s ease;
}

.insert-image:hover {
  background: var(--primary-dark);
}

/* Autosave Status */
#autosaveStatus {
  animation: fadeIn 0.3s ease;
}

#autosaveIcon {
  font-size: 16px;
}

.autosave-saving {
  color: var(--warning);
}

.autosave-saved {
  color: var(--success);
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  animation: fadeIn 0.2s ease;
}

.modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: var(--bg-surface);
  padding: 32px;
  border-radius: var(--radius);
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: var(--shadow-lg);
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid var(--border);
}

.modal-header h3 {
  margin: 0;
  font-size: 20px;
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-secondary);
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s ease;
}

.modal-close:hover {
  background: var(--bg-main);
  color: var(--text-primary);
}

.draft-item {
  padding: 16px;
  margin: 8px 0;
  background: var(--bg-main);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s ease;
  border: 2px solid transparent;
}

.draft-item:hover {
  background: var(--bg-surface);
  border-color: var(--primary);
  transform: translateX(4px);
}

.draft-item-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.draft-item-meta {
  font-size: 13px;
  color: var(--text-secondary);
}

/* Responsive */
@media (max-width: 968px) {
  .editor {
    grid-template-columns: 1fr;
  }
  
  .meta-grid {
    grid-template-columns: 1fr;
  }
  
  nav button {
    min-width: 100px;
    font-size: 13px;
  }
  
  .container {
    padding: 20px;
  }
}

/* Loading Animation */
@keyframes shimmer {
  0% { background-position: -1000px 0; }
  100% { background-position: 1000px 0; }
}

.loading {
  animation: shimmer 2s infinite;
  background: linear-gradient(to right, var(--bg-main) 4%, var(--bg-surface) 25%, var(--bg-main) 36%);
  background-size: 1000px 100%;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: var(--bg-main);
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-tertiary);
}
</style>
</head>

<body>

<header>
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h2>Affiliate Blog Scheduler Pro</h2>
      <div class="subtitle">Create, optimize, and schedule your affiliate content</div>
    </div>
    <div style="display: flex; align-items: center; gap: 16px;">
      <div id="autosaveStatus" style="font-size: 13px; opacity: 0.8; display: flex; align-items: center; gap: 8px;">
        <span id="autosaveIcon">üíæ</span>
        <span id="autosaveText">Autosave enabled</span>
      </div>
      <button onclick="loadDraft()" class="btn btn-secondary" style="padding: 8px 16px; font-size: 13px;">
        üìÇ Load Draft
      </button>
    </div>
  </div>
</header>

<nav>
  <button onclick="openTab('editor')" class="active" id="nav-editor">‚úèÔ∏è Editor</button>
  <button onclick="openTab('seo')" id="nav-seo">üìä SEO Analysis</button>
  <button onclick="openTab('schedule')" id="nav-schedule">üìÖ Schedule</button>
  <button onclick="openTab('deploy')" id="nav-deploy">üíæ Drafts</button>
  <button onclick="openTab('affiliate')" id="nav-affiliate">üîó Affiliate Links</button>
</nav>

<div class="container">

<!-- EDITOR -->
<section id="editor" class="active">
  <div class="panel">
    <h3>Post Metadata</h3>
    
    <div class="meta-grid">
      <input id="title" placeholder="Post Title" type="text">
      <input id="slug" placeholder="Slug (e.g., best-robot-vacuum)" type="text">
    </div>
    
    <textarea id="description" placeholder="Meta Description (150-160 characters recommended)" rows="3"></textarea>
    
    <h4>Categories</h4>
    <input type="text" id="categorySearch" placeholder="üîç Search categories..." style="margin-bottom: 12px;">
    <div class="selected-categories" id="selectedCategories"></div>
    <div id="categorySelect" class="multi-select"></div>
    
    <h4>Tags</h4>
    <input id="tags" placeholder="Comma separated tags (e.g., review, comparison, budget-friendly)" type="text">
    
    <h4>SEO Keywords</h4>
    <input id="seoKeywords" placeholder="Comma separated keywords (e.g., robot vacuum, smart home, cleaning)" type="text">
    
    <h4>Featured Image</h4>
    <div class="image-upload-area">
      <input type="file" id="imageUpload" accept="image/*" style="display: none;">
      <button onclick="document.getElementById('imageUpload').click()" class="btn btn-secondary" style="width: 100%;">üì∏ Upload Featured Image</button>
      <div id="imagePreviewContainer" style="margin-top: 12px;"></div>
    </div>
    
    <label>
      <input type="checkbox" id="disclaimer">
      <span>Add FTC Affiliate Disclosure</span>
    </label>
  </div>
  
  <div class="panel">
    <h3>Content Editor</h3>
    
    <div class="editor">
      <div class="editor-pane">
        <div class="editor-header">
          <span class="editor-title">Markdown Editor</span>
          <span class="word-count" id="wordCount">0 words</span>
        </div>
        <textarea id="content" placeholder="Write or paste your content here in Markdown format...

## Example Heading
Your content goes here with **bold**, *italic*, and [links](https://example.com).

### Subheading
- Bullet point 1
- Bullet point 2

![Image](image-url.jpg)"></textarea>
      </div>
      
      <div class="editor-pane">
        <div class="editor-header">
          <span class="editor-title">Live Preview</span>
        </div>
        <div class="preview" id="preview">
          <div class="empty-state">
            <div class="empty-state-icon">üìù</div>
            <div class="empty-state-text">Start typing to see your content preview</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- SEO -->
<section id="seo">
  <div class="panel">
    <h3>SEO Analysis</h3>
    
    <div class="score-container">
      <div class="score-circle" id="scoreCircle">0%</div>
      <div class="score-details">
        <div class="score-label">Overall SEO Score</div>
        <div class="score-text" id="scoreText">Your content needs work</div>
      </div>
    </div>
    
    <h4>Detailed Checks</h4>
    <ul id="seoList"></ul>
  </div>
  
  <div class="panel">
    <h3>Content Statistics</h3>
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-value" id="statWords">0</div>
        <div class="stat-label">Words</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statChars">0</div>
        <div class="stat-label">Characters</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statHeadings">0</div>
        <div class="stat-label">Headings</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statLinks">0</div>
        <div class="stat-label">Links</div>
      </div>
    </div>
  </div>
</section>

<!-- SCHEDULE -->
<section id="schedule">
  <div class="panel">
    <h3>Schedule Publication</h3>
    
    <label>
      <span style="font-weight: 600; color: var(--text-primary);">Publication Date & Time</span>
    </label>
    <input type="datetime-local" id="publishDate">
    
    <div class="action-row">
      <button onclick="preparePost()" class="btn btn-primary">üöÄ Prepare Post for Publishing</button>
      <button onclick="clearForm()" class="btn btn-secondary">üóëÔ∏è Clear Form</button>
    </div>
    
    <div id="finalPostContainer" style="display: none; margin-top: 24px;">
      <h4>Generated Post Preview</h4>
      <pre id="finalPost"></pre>
    </div>
  </div>
</section>

<!-- DEPLOY / DRAFTS -->
<section id="deploy">
  <div class="panel">
    <h3>Save & Export</h3>
    
    <p style="color: var(--text-secondary); margin-bottom: 20px;">
      Save your prepared post as a Markdown file to your local drafts folder.
    </p>
    
    <div class="action-row">
      <button onclick="saveDraft()" class="btn btn-success">üíæ Save Draft to File</button>
      <button onclick="exportJSON()" class="btn btn-secondary">üìÑ Export as JSON</button>
      <button onclick="copyToClipboard()" class="btn btn-secondary">üìã Copy to Clipboard</button>
    </div>
  </div>
  
  <div class="panel">
    <h3>Draft History</h3>
    <table>
      <thead>
        <tr>
          <th>Slug</th>
          <th>Title</th>
          <th>Scheduled Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="draftList"></tbody>
    </table>
    <div id="emptyDrafts" class="empty-state" style="display: none;">
      <div class="empty-state-icon">üì≠</div>
      <div class="empty-state-text">No drafts saved yet</div>
    </div>
  </div>
</section>

<!-- AFFILIATE LINKS -->
<section id="affiliate">
  <div class="panel">
    <h3>Affiliate Link Manager</h3>
    
    <div class="search-container">
      <input type="text" id="affiliateSearch" placeholder="Search products, brands, or categories...">
      <button onclick="searchAffiliate()" class="btn btn-primary">üîç Search</button>
    </div>
    
    <div id="affiliateResultsContainer">
      <ul id="affiliateResults"></ul>
      <div id="emptyAffiliate" class="empty-state" style="display: none;">
        <div class="empty-state-icon">üîó</div>
        <div class="empty-state-text">Search for affiliate links to get started</div>
      </div>
    </div>
  </div>
  
  <div class="panel">
    <h3>Quick Add Link</h3>
    <input type="text" id="newLinkName" placeholder="Product Name">
    <input type="text" id="newLinkUrl" placeholder="Affiliate URL">
    <button onclick="addAffiliateLink()" class="btn btn-primary">‚ûï Add to Catalog</button>
  </div>
</section>

</div>

<!-- Load Draft Modal -->
<div id="loadDraftModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Load Autosaved Draft</h3>
      <button class="modal-close" onclick="closeLoadModal()">√ó</button>
    </div>
    <div id="autosaveDraftPreview"></div>
  </div>
</div>

<script>
/* ---------------- STATE ---------------- */
let currentTab = 'editor';
let autosaveInterval;
let uploadedImage = null;
let affiliateCatalog = [
  {name:"Roomba 960 Robot Vacuum", link:"https://amzn.to/roomba960", category: "Smart Home"},
  {name:"Dyson V11 Cordless Vacuum", link:"https://amzn.to/dysonv11", category: "Appliances"},
  {name:"Ikea Kallax Shelf Unit", link:"https://ikea.com/kallax?aff=123", category: "Furniture"},
  {name:"Philips Hue Smart Lights", link:"https://amzn.to/philipshue", category: "Smart Home"},
  {name:"Instant Pot Duo 7-in-1", link:"https://amzn.to/instantpot", category: "Kitchen"},
];

/* ---------------- IMAGE UPLOAD ---------------- */
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('imageUpload').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
      alert('‚ö†Ô∏è Please upload an image file');
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      uploadedImage = {
        name: file.name,
        size: file.size,
        type: file.type,
        data: e.target.result
      };
      
      displayImagePreview();
      triggerAutosave();
    };
    reader.readAsDataURL(file);
  });
});

function displayImagePreview() {
  const container = document.getElementById('imagePreviewContainer');
  
  if (!uploadedImage) {
    container.innerHTML = '';
    return;
  }
  
  const sizeKB = (uploadedImage.size / 1024).toFixed(2);
  
  container.innerHTML = `
    <div class="image-preview">
      <img src="${uploadedImage.data}" alt="Featured image preview">
      <div class="image-preview-info">
        <span>${uploadedImage.name} (${sizeKB} KB)</span>
      </div>
      <div class="image-preview-actions">
        <button onclick="insertImageIntoContent()" class="insert-image">üìù Insert into Content</button>
        <button onclick="removeImage()" class="remove-image">üóëÔ∏è Remove</button>
      </div>
    </div>
  `;
}

function insertImageIntoContent() {
  const imageMarkdown = `![${uploadedImage.name}](${uploadedImage.data})`;
  const textarea = content;
  
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const text = textarea.value;
  
  textarea.value = text.substring(0, start) + imageMarkdown + text.substring(end);
  textarea.selectionStart = textarea.selectionEnd = start + imageMarkdown.length;
  textarea.focus();
  
  updatePreview();
  alert('‚úÖ Image inserted into content');
}

function removeImage() {
  if (!confirm('Remove the featured image?')) return;
  uploadedImage = null;
  displayImagePreview();
  document.getElementById('imageUpload').value = '';
  triggerAutosave();
}

/* ---------------- AUTOSAVE ---------------- */
function startAutosave() {
  // Autosave every 30 seconds
  autosaveInterval = setInterval(() => {
    saveToAutosave();
  }, 30000);
  
  // Add autosave triggers on input
  const autoSaveInputs = [
    document.getElementById('title'),
    document.getElementById('slug'),
    document.getElementById('content'),
    document.getElementById('description'),
    document.getElementById('tags'),
    document.getElementById('seoKeywords')
  ];
  
  autoSaveInputs.forEach(input => {
    if (input) {
      input.addEventListener('input', () => {
        clearTimeout(window.autosaveTimeout);
        window.autosaveTimeout = setTimeout(triggerAutosave, 2000);
      });
    }
  });
}

function saveToAutosave() {
  const autosaveData = {
    title: title.value,
    slug: slug.value,
    description: document.getElementById('description').value,
    content: content.value,
    tags: document.getElementById('tags').value,
    keywords: document.getElementById('seoKeywords').value,
    categories: Array.from(document.querySelectorAll('#categorySelect input:checked')).map(c => c.value),
    publishDate: document.getElementById('publishDate').value,
    disclaimer: document.getElementById('disclaimer').checked,
    image: uploadedImage,
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem('autosave', JSON.stringify(autosaveData));
  updateAutosaveStatus('saved');
}

function triggerAutosave() {
  updateAutosaveStatus('saving');
  setTimeout(() => {
    saveToAutosave();
  }, 500);
}

function updateAutosaveStatus(status) {
  const icon = document.getElementById('autosaveIcon');
  const text = document.getElementById('autosaveText');
  const statusEl = document.getElementById('autosaveStatus');
  
  if (!icon || !text) return;
  
  statusEl.className = '';
  
  if (status === 'saving') {
    icon.textContent = 'üíæ';
    text.textContent = 'Saving...';
    statusEl.classList.add('autosave-saving');
  } else if (status === 'saved') {
    icon.textContent = '‚úÖ';
    text.textContent = 'Autosaved';
    statusEl.classList.add('autosave-saved');
    
    setTimeout(() => {
      icon.textContent = 'üíæ';
      text.textContent = 'Autosave enabled';
      statusEl.className = '';
    }, 2000);
  }
}

function loadDraft() {
  const autosaveData = localStorage.getItem('autosave');
  
  if (!autosaveData) {
    alert('‚ÑπÔ∏è No autosaved draft found');
    return;
  }
  
  const modal = document.getElementById('loadDraftModal');
  const preview = document.getElementById('autosaveDraftPreview');
  
  const data = JSON.parse(autosaveData);
  const savedDate = new Date(data.timestamp);
  
  preview.innerHTML = `
    <div class="draft-item" onclick="restoreAutosave()">
      <div class="draft-item-title">${data.title || 'Untitled Post'}</div>
      <div class="draft-item-meta">
        Last saved: ${savedDate.toLocaleString()}<br>
        ${data.content ? data.content.split(/\s+/).length + ' words' : 'No content'}<br>
        ${data.categories ? data.categories.length + ' categories' : 'No categories'}
      </div>
      <div style="margin-top: 12px;">
        <button class="btn btn-primary" onclick="restoreAutosave(); event.stopPropagation();">üìÇ Restore This Draft</button>
        <button class="btn btn-secondary" onclick="clearAutosave(); event.stopPropagation();" style="margin-left: 8px;">üóëÔ∏è Delete</button>
      </div>
    </div>
  `;
  
  modal.classList.add('active');
}

function closeLoadModal() {
  document.getElementById('loadDraftModal').classList.remove('active');
}

function restoreAutosave() {
  const autosaveData = localStorage.getItem('autosave');
  if (!autosaveData) return;
  
  const data = JSON.parse(autosaveData);
  
  title.value = data.title || '';
  slug.value = data.slug || '';
  document.getElementById('description').value = data.description || '';
  content.value = data.content || '';
  document.getElementById('tags').value = data.tags || '';
  document.getElementById('seoKeywords').value = data.keywords || '';
  document.getElementById('publishDate').value = data.publishDate || '';
  document.getElementById('disclaimer').checked = data.disclaimer || false;
  
  // Restore image
  if (data.image) {
    uploadedImage = data.image;
    displayImagePreview();
  }
  
  // Restore categories
  document.querySelectorAll('#categorySelect input[type="checkbox"]').forEach(cb => {
    cb.checked = data.categories && data.categories.includes(cb.value);
  });
  updateSelectedCategories();
  
  updatePreview();
  closeLoadModal();
  
  alert('‚úÖ Draft restored successfully!');
}

function clearAutosave() {
  if (!confirm('Are you sure you want to delete the autosaved draft?')) return;
  
  localStorage.removeItem('autosave');
  closeLoadModal();
  alert('‚úÖ Autosaved draft deleted');
}

/* ---------------- TAB NAVIGATION ---------------- */
function openTab(tab) {
  // Update sections
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
  
  // Update nav buttons
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById('nav-' + tab).classList.add('active');
  
  currentTab = tab;
  
  // Run SEO check when opening SEO tab
  if (tab === 'seo') {
    runSEO();
  }
}

/* ---------------- SLUG GENERATION ---------------- */
const title = document.getElementById('title');
const slug = document.getElementById('slug');

function generateSlug(text) {
  return text.toLowerCase().trim()
    .replace(/[^\w\s-]/g, "")
    .replace(/\s+/g, "-")
    .replace(/--+/g, "-")
    .replace(/^-+|-+$/g, "");
}

title.addEventListener('input', () => { 
  if (!slug.value || slug.dataset.autoGenerated === 'true') {
    slug.value = generateSlug(title.value);
    slug.dataset.autoGenerated = 'true';
  }
});

slug.addEventListener('input', () => {
  slug.dataset.autoGenerated = 'false';
});

/* ---------------- LIVE PREVIEW & WORD COUNT ---------------- */
const content = document.getElementById('content');
const preview = document.getElementById('preview');
const wordCount = document.getElementById('wordCount');

content.addEventListener('input', updatePreview);

function updatePreview() {
  const text = content.value;
  
  if (text.trim()) {
    preview.innerHTML = marked.parse(text);
  } else {
    preview.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üìù</div>
        <div class="empty-state-text">Start typing to see your content preview</div>
      </div>
    `;
  }
  
  // Update word count
  const words = text.trim().split(/\s+/).filter(Boolean).length;
  wordCount.textContent = words + ' words';
  
  // Auto-run SEO if on SEO tab
  if (currentTab === 'seo') {
    runSEO();
  }
}

/* ---------------- SEO ANALYSIS ---------------- */
function runSEO() {
  let score = 0;
  let checks = [];
  const text = content.value;
  const titleText = title.value;
  const descText = document.getElementById('description').value;
  
  // Word count check
  const words = text.trim().split(/\s+/).filter(Boolean).length;
  if (words >= 800) {
    score += 15;
    checks.push({pass: true, text: `Great content length (${words} words)`});
  } else {
    checks.push({pass: false, text: `Content too short (${words} words, aim for 800+)`});
  }
  
  // Heading check
  const headings = (text.match(/^#{1,6}\s/gm) || []).length;
  if (headings >= 3) {
    score += 15;
    checks.push({pass: true, text: `Good use of headings (${headings} found)`});
  } else {
    checks.push({pass: false, text: `Add more headings for better structure (${headings} found, aim for 3+)`});
  }
  
  // Links check
  const links = (text.match(/\[.*?\]\(.*?\)/g) || []).length;
  if (links >= 3) {
    score += 15;
    checks.push({pass: true, text: `Good internal/external linking (${links} links)`});
  } else {
    checks.push({pass: false, text: `Add more links (${links} found, aim for 3+)`});
  }
  
  // Images check
  const images = (text.match(/!\[.*?\]\(.*?\)/g) || []).length;
  if (images >= 2) {
    score += 15;
    checks.push({pass: true, text: `Images included (${images} found)`});
  } else {
    checks.push({pass: false, text: `Add images for visual appeal (${images} found, aim for 2+)`});
  }
  
  // Title check
  if (titleText.length >= 30 && titleText.length <= 60) {
    score += 10;
    checks.push({pass: true, text: `Title length optimal (${titleText.length} chars)`});
  } else if (titleText.length > 0) {
    checks.push({pass: false, text: `Title should be 30-60 characters (currently ${titleText.length})`});
  } else {
    checks.push({pass: false, text: `Add a compelling title`});
  }
  
  // Meta description check
  if (descText.length >= 120 && descText.length <= 160) {
    score += 10;
    checks.push({pass: true, text: `Meta description length perfect (${descText.length} chars)`});
  } else if (descText.length > 0) {
    checks.push({pass: false, text: `Meta description should be 120-160 chars (currently ${descText.length})`});
  } else {
    checks.push({pass: false, text: `Add a meta description`});
  }
  
  // Keywords check
  const keywords = document.getElementById('seoKeywords').value.split(',').filter(k => k.trim()).length;
  if (keywords >= 3) {
    score += 10;
    checks.push({pass: true, text: `Keywords defined (${keywords} keywords)`});
  } else {
    checks.push({pass: false, text: `Add SEO keywords (${keywords} found, aim for 3-5)`});
  }
  
  // Categories check
  const selectedCats = document.querySelectorAll('#categorySelect input:checked').length;
  if (selectedCats >= 1) {
    score += 10;
    checks.push({pass: true, text: `Categories selected (${selectedCats})`});
  } else {
    checks.push({pass: false, text: `Select at least one category`});
  }
  
  // Update score display
  const scoreCircle = document.getElementById('scoreCircle');
  const scoreText = document.getElementById('scoreText');
  
  scoreCircle.textContent = score + '%';
  scoreCircle.className = 'score-circle';
  
  if (score < 50) {
    scoreCircle.classList.add('low');
    scoreText.textContent = 'Needs significant improvement';
  } else if (score < 80) {
    scoreCircle.classList.add('medium');
    scoreText.textContent = 'Good, but could be better';
  } else {
    scoreCircle.classList.add('high');
    scoreText.textContent = 'Excellent SEO optimization!';
  }
  
  // Update checklist
  const seoList = document.getElementById('seoList');
  seoList.innerHTML = '';
  checks.forEach(check => {
    const li = document.createElement('li');
    li.className = check.pass ? 'pass' : 'fail';
    li.textContent = check.text;
    seoList.appendChild(li);
  });
  
  // Update stats
  document.getElementById('statWords').textContent = words;
  document.getElementById('statChars').textContent = text.length;
  document.getElementById('statHeadings').textContent = headings;
  document.getElementById('statLinks').textContent = links;
}

/* ---------------- PREPARE POST ---------------- */
function preparePost() {
  const selectedCats = Array.from(document.querySelectorAll('#categorySelect input:checked')).map(c => c.value);
  const tags = document.getElementById('tags').value.split(',').map(t => t.trim()).filter(Boolean);
  const keys = document.getElementById('seoKeywords').value.split(',').map(k => k.trim()).filter(Boolean);
  const scheduled = document.getElementById('publishDate').value;
  
  if (!title.value) {
    alert('‚ö†Ô∏è Please add a post title');
    return;
  }
  
  if (!slug.value) {
    alert('‚ö†Ô∏è Please add a slug');
    return;
  }
  
  if (!scheduled) {
    alert('‚ö†Ô∏è Please set a publication date');
    return;
  }
  
  const scheduledISO = new Date(scheduled).toISOString();
  
  let frontmatter = `---
title: "${title.value}"
description: "${document.getElementById('description').value}"
slug: "${slug.value}"
scheduled_date: ${scheduledISO}
categories:
${selectedCats.map(c => "  - " + c).join("\n")}
tags:
${tags.map(t => "  - " + t).join("\n")}
keywords:
${keys.map(k => "  - " + k).join("\n")}
${uploadedImage ? `featured_image: "${uploadedImage.name}"` : ''}
published: false
---

`;
  
  let disclosure = document.getElementById('disclaimer').checked ? 
    `> ‚ö†Ô∏è **FTC Disclosure**: This post contains affiliate links. We may earn a commission if you make a purchase through these links at no additional cost to you.

` : "";
  
  const finalPost = document.getElementById('finalPost');
  finalPost.textContent = frontmatter + disclosure + content.value;
  
  document.getElementById('finalPostContainer').style.display = 'block';
  
  // Save to draft history
  saveToDraftHistory();
}

/* ---------------- SAVE DRAFT ---------------- */
function saveDraft() {
  const finalPost = document.getElementById('finalPost');
  
  if (!finalPost.textContent) {
    alert('‚ö†Ô∏è Please prepare the post first in the Schedule tab');
    return;
  }
  
  if (!slug.value) {
    alert('‚ö†Ô∏è Slug is required to save');
    return;
  }
  
  const filename = `${slug.value}.md`;
  const blob = new Blob([finalPost.textContent], {type: "text/markdown"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  
  alert('‚úÖ Draft saved successfully!');
}

function exportJSON() {
  const data = {
    title: title.value,
    slug: slug.value,
    description: document.getElementById('description').value,
    content: content.value,
    tags: document.getElementById('tags').value.split(',').map(t => t.trim()).filter(Boolean),
    keywords: document.getElementById('seoKeywords').value.split(',').map(k => k.trim()).filter(Boolean),
    categories: Array.from(document.querySelectorAll('#categorySelect input:checked')).map(c => c.value),
    scheduledDate: document.getElementById('publishDate').value,
    disclaimer: document.getElementById('disclaimer').checked,
    featuredImage: uploadedImage
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `${slug.value || 'post'}.json`;
  a.click();
  
  alert('‚úÖ Exported as JSON!');
}

function copyToClipboard() {
  const finalPost = document.getElementById('finalPost');
  
  if (!finalPost.textContent) {
    alert('‚ö†Ô∏è Please prepare the post first');
    return;
  }
  
  navigator.clipboard.writeText(finalPost.textContent).then(() => {
    alert('‚úÖ Copied to clipboard!');
  }).catch(() => {
    alert('‚ùå Failed to copy to clipboard');
  });
}

/* ---------------- DRAFT HISTORY ---------------- */
function saveToDraftHistory() {
  let drafts = JSON.parse(localStorage.getItem('drafts') || '[]');
  
  const draft = {
    slug: slug.value,
    title: title.value,
    scheduled: document.getElementById('publishDate').value,
    savedAt: new Date().toISOString()
  };
  
  // Remove existing draft with same slug
  drafts = drafts.filter(d => d.slug !== slug.value);
  drafts.unshift(draft);
  
  // Keep only last 20 drafts
  drafts = drafts.slice(0, 20);
  
  localStorage.setItem('drafts', JSON.stringify(drafts));
  updateDraftTable();
}

function updateDraftTable() {
  const drafts = JSON.parse(localStorage.getItem('drafts') || '[]');
  const draftList = document.getElementById('draftList');
  const emptyState = document.getElementById('emptyDrafts');
  
  if (drafts.length === 0) {
    draftList.innerHTML = '';
    emptyState.style.display = 'block';
    return;
  }
  
  emptyState.style.display = 'none';
  draftList.innerHTML = '';
  
  drafts.forEach((draft, index) => {
    const tr = document.createElement('tr');
    
    const scheduled = draft.scheduled ? new Date(draft.scheduled) : null;
    const now = new Date();
    let status = 'üìù Draft';
    let statusClass = 'status-draft';
    
    if (scheduled) {
      if (scheduled <= now) {
        status = '‚úÖ Ready';
        statusClass = 'status-ready';
      } else {
        status = '‚è≥ Scheduled';
        statusClass = 'status-scheduled';
      }
    }
    
    const scheduledDisplay = scheduled ? 
      scheduled.toLocaleString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      }) : '‚Äî';
    
    tr.innerHTML = `
      <td><code>${draft.slug}</code></td>
      <td>${draft.title || 'Untitled'}</td>
      <td>${scheduledDisplay}</td>
      <td><span class="status-badge ${statusClass}">${status}</span></td>
      <td><button onclick="deleteDraft(${index})" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;">üóëÔ∏è Delete</button></td>
    `;
    
    draftList.appendChild(tr);
  });
}

function deleteDraft(index) {
  if (!confirm('Are you sure you want to delete this draft?')) return;
  
  let drafts = JSON.parse(localStorage.getItem('drafts') || '[]');
  drafts.splice(index, 1);
  localStorage.setItem('drafts', JSON.stringify(drafts));
  updateDraftTable();
}

/* ---------------- AFFILIATE LINKS ---------------- */
function searchAffiliate() {
  const query = document.getElementById('affiliateSearch').value.toLowerCase().trim();
  const resultsEl = document.getElementById('affiliateResults');
  const emptyState = document.getElementById('emptyAffiliate');
  
  resultsEl.innerHTML = '';
  
  if (!query) {
    emptyState.style.display = 'block';
    return;
  }
  
  const results = affiliateCatalog.filter(a => 
    a.name.toLowerCase().includes(query) || 
    a.category.toLowerCase().includes(query)
  );
  
  if (results.length === 0) {
    emptyState.style.display = 'block';
    resultsEl.innerHTML = '<li style="text-align: center; color: var(--text-secondary);">No results found</li>';
    return;
  }
  
  emptyState.style.display = 'none';
  
  results.forEach(a => {
    const li = document.createElement('li');
    li.innerHTML = `
      <div>
        <div class="affiliate-name">${a.name}</div>
        <div style="font-size: 13px; color: var(--text-tertiary); margin-top: 4px;">${a.category}</div>
      </div>
      <a href="#" class="affiliate-link" onclick="insertAffiliateLink('${a.name}', '${a.link}'); return false;">üìé Insert Link</a>
    `;
    resultsEl.appendChild(li);
  });
}

function insertAffiliateLink(name, link) {
  const linkMarkdown = `[${name}](${link})`;
  const textarea = content;
  
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const text = textarea.value;
  
  textarea.value = text.substring(0, start) + linkMarkdown + text.substring(end);
  
  // Set cursor position after inserted link
  textarea.selectionStart = textarea.selectionEnd = start + linkMarkdown.length;
  textarea.focus();
  
  updatePreview();
  
  alert(`‚úÖ Inserted link for "${name}"`);
}

function addAffiliateLink() {
  const name = document.getElementById('newLinkName').value.trim();
  const url = document.getElementById('newLinkUrl').value.trim();
  
  if (!name || !url) {
    alert('‚ö†Ô∏è Please enter both product name and URL');
    return;
  }
  
  affiliateCatalog.push({
    name: name,
    link: url,
    category: 'Custom'
  });
  
  document.getElementById('newLinkName').value = '';
  document.getElementById('newLinkUrl').value = '';
  
  alert(`‚úÖ Added "${name}" to catalog`);
}

/* ---------------- CATEGORIES ---------------- */
const categoriesList = {
  "Core Rooms": ["Living Room", "Bedroom", "Dining Room", "Home Office", "Kitchen", "Bathroom", "Entryway & Hallway", "Laundry Room", "Kids Room & Nursery", "Outdoor & Patio", "Balcony & Small Spaces"],
  "Furniture Types": ["Sofas & Seating", "Beds & Bed Frames", "Mattresses", "Tables & Desks", "Chairs & Stools", "Wardrobes & Closets", "TV Stands & Media Units", "Shelving & Bookcases", "Storage Furniture"],
  "Decor": ["Wall Decor", "Lighting & Lamps", "Rugs & Carpets", "Curtains & Window Treatments", "Mirrors", "Cushions & Throws", "Vases & Decorative Accents", "Clocks", "Plants & Planters"],
  "Storage & Organization": ["General Storage", "Closet Organization", "Shoe Storage", "Kitchen Storage Solutions", "Bathroom Storage Solutions", "Small Space Storage"],
  "Style-Based": ["Modern Style", "Minimalist Style", "Scandinavian Style", "Luxury & Glam Decor", "Boho & Rustic Decor", "Traditional & Classic", "Industrial Style"],
  "Buying Intent": ["Budget Furniture", "Luxury Furniture", "Space-Saving Furniture", "Multifunctional Furniture", "Furniture Buying Guides", "Best Of Lists", "Product Reviews", "Comparisons"],
  "DIY & Care": ["DIY & Home Improvement", "Furniture Care & Maintenance", "Cleaning & Care Tips", "Furniture Assembly Tips"],
  "Seasonal & Lifestyle": ["Seasonal Decor", "Holiday Decor", "Home Makeovers", "Rental-Friendly Decor"],
  "Gifts": ["Home Gift Ideas", "Housewarming Gifts", "Luxury Home Gifts", "Budget Gift Ideas"]
};

function initializeCategories() {
  const categorySelectEl = document.getElementById('categorySelect');
  
  Object.keys(categoriesList).forEach(group => {
    const groupDiv = document.createElement('div');
    groupDiv.className = 'category-group';
    groupDiv.dataset.group = group;
    
    const groupTitle = document.createElement('div');
    groupTitle.className = 'category-group-title';
    groupTitle.textContent = group;
    groupDiv.appendChild(groupTitle);
    
    categoriesList[group].forEach(cat => {
      const label = document.createElement('label');
      label.dataset.category = cat.toLowerCase();
      label.dataset.group = group.toLowerCase();
      
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = cat;
      checkbox.id = 'cat_' + cat.replace(/\s+/g, '_');
      
      // Add change event listener
      checkbox.addEventListener('change', updateSelectedCategories);
      
      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(' ' + cat));
      groupDiv.appendChild(label);
    });
    
    categorySelectEl.appendChild(groupDiv);
  });
  
  // Add search functionality
  const searchInput = document.getElementById('categorySearch');
  searchInput.addEventListener('input', filterCategories);
}

function filterCategories() {
  const searchTerm = document.getElementById('categorySearch').value.toLowerCase().trim();
  const groups = document.querySelectorAll('.category-group');
  
  if (!searchTerm) {
    // Show all
    groups.forEach(group => {
      group.classList.remove('hidden');
      group.querySelectorAll('label').forEach(label => {
        label.classList.remove('hidden');
      });
    });
    return;
  }
  
  groups.forEach(group => {
    let hasVisibleItems = false;
    
    group.querySelectorAll('label').forEach(label => {
      const categoryName = label.dataset.category;
      const groupName = label.dataset.group;
      
      if (categoryName.includes(searchTerm) || groupName.includes(searchTerm)) {
        label.classList.remove('hidden');
        hasVisibleItems = true;
      } else {
        label.classList.add('hidden');
      }
    });
    
    // Hide group if no items match
    if (hasVisibleItems) {
      group.classList.remove('hidden');
    } else {
      group.classList.add('hidden');
    }
  });
}

function updateSelectedCategories() {
  const selectedContainer = document.getElementById('selectedCategories');
  const selectedCheckboxes = document.querySelectorAll('#categorySelect input[type="checkbox"]:checked');
  
  selectedContainer.innerHTML = '';
  
  selectedCheckboxes.forEach(checkbox => {
    const badge = document.createElement('div');
    badge.className = 'category-badge';
    
    const text = document.createElement('span');
    text.textContent = checkbox.value;
    
    const removeBtn = document.createElement('button');
    removeBtn.innerHTML = '√ó';
    removeBtn.title = 'Remove category';
    removeBtn.onclick = () => {
      checkbox.checked = false;
      updateSelectedCategories();
    };
    
    badge.appendChild(text);
    badge.appendChild(removeBtn);
    selectedContainer.appendChild(badge);
  });
}

/* ---------------- CLEAR FORM ---------------- */
function clearForm() {
  if (!confirm('Are you sure you want to clear the entire form?')) return;
  
  title.value = '';
  slug.value = '';
  document.getElementById('description').value = '';
  content.value = '';
  document.getElementById('tags').value = '';
  document.getElementById('seoKeywords').value = '';
  document.getElementById('publishDate').value = '';
  document.getElementById('disclaimer').checked = false;
  
  // Clear image
  uploadedImage = null;
  displayImagePreview();
  document.getElementById('imageUpload').value = '';
  
  document.querySelectorAll('#categorySelect input[type="checkbox"]').forEach(cb => cb.checked = false);
  updateSelectedCategories();
  
  updatePreview();
  runSEO();
  
  document.getElementById('finalPostContainer').style.display = 'none';
}

/* ---------------- KEYBOARD SHORTCUTS ---------------- */
document.addEventListener('keydown', (e) => {
  // Ctrl/Cmd + S to save draft
  if ((e.ctrlKey || e.metaKey) && e.key === 's') {
    e.preventDefault();
    if (document.getElementById('finalPost').textContent) {
      saveDraft();
    } else {
      alert('‚ö†Ô∏è Please prepare the post first');
    }
  }
  
  // Ctrl/Cmd + Enter to prepare post
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
    e.preventDefault();
    preparePost();
  }
});

/* ---------------- INITIALIZATION ---------------- */
document.addEventListener('DOMContentLoaded', () => {
  initializeCategories();
  updateDraftTable();
  updatePreview();
  
  // Show empty state for affiliate search
  document.getElementById('emptyAffiliate').style.display = 'block';
  
  // Start autosave
  startAutosave();
  
  // Check for existing autosave
  const autosaveData = localStorage.getItem('autosave');
  if (autosaveData) {
    const data = JSON.parse(autosaveData);
    const savedDate = new Date(data.timestamp);
    const minutesAgo = Math.floor((Date.now() - savedDate.getTime()) / 60000);
    
    if (minutesAgo < 1440) { // Less than 24 hours
      setTimeout(() => {
        if (confirm(`Found an autosaved draft from ${minutesAgo < 60 ? minutesAgo + ' minutes' : Math.floor(minutesAgo / 60) + ' hours'} ago. Would you like to restore it?`)) {
          loadDraft();
        }
      }, 1000);
    }
  }
});
</script>

</body>
</html>
